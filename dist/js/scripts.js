var vgApp=angular.module("vgApp",["ui.router","ui.bootstrap","ui-notification","LocalStorageModule","angular-loading-bar","angularValidator","angularModalService","angular-page-loader","ngImgCrop","slickCarousel"]);vgApp.config(["slickCarouselConfig",function(e){e.dots=!0,e.autoplay=!1}]),vgApp.config(["$urlRouterProvider","$stateProvider","$httpProvider","$locationProvider",function(e,t,a,o){e.otherwise("login"),o.html5Mode({enabled:!0,requireBase:!1})}]),vgApp.directive("ddc",function(e){return{restrict:"A",link:function(t,a,o){a.bind("click",function(){e(function(){a.attr("disabled","disabled")},20),e(function(){a.removeAttr("disabled")},500)})}}}),vgApp.directive("onlyAlphabets",function(){return{require:"ngModel",link:function(e,t,a,o){o.$parsers.push(function(e){var t=e.replace(/[^0-9a-z-]/g,"");return t!==e&&(o.$setViewValue(t),o.$render()),t})}}}),vgApp.directive("disallowSpaces",function(){return{restrict:"A",link:function(e,t){t.bind("input",function(){$(this).val($(this).val().replace(/[$&,:;=?@|<>.^*()%! ]/,""))})}}}),vgApp.directive("numericOnly",function(){return{restrict:"A",link:function(e,t,a){var o=RegExp(a.restrictTo),n=/Backspace|Enter|Tab|Delete|Del|ArrowUp|Up|ArrowDown|Down|ArrowLeft|Left|ArrowRight|Right/;t[0].addEventListener("keydown",function(e){n.test(e.key)||o.test(e.key)||e.preventDefault()})}}}),vgApp.run(["$rootScope","$state","loginService","$q","$location",function(e,t,a,o,n){e.domainURL=domainURL,localStorage.getItem("orgId")&&null!=localStorage.getItem("orgId")&&null!=localStorage.getItem("userId")&&void 0!=localStorage.getItem("orgId")&&void 0!=localStorage.getItem("userId")&&void 0!=localStorage.getItem("access_token")&&null!=localStorage.getItem("access_token")?(e.orgId=localStorage.getItem("orgId"),a.isAuthenticated().then(function(t){a.getUserDetails().then(function(t){e.isAdmin=!0,e.fullName=t.data.data.fullName,e.profilePic=t.data.data.profilePic,e.userId=t.data.data._id,e.org=t.data.data.org,e.orgId=t.data.data.org[0].organisationId._id,e.orgname=e.org[0].organisationId.organisationId,e.orgstatus=e.org[0].organisationId.status,"pendingstock"==t.data.data.status&&(e.userstatus="pending")},function(e){})},function(e){n.path("/login")})):window.location.pathname.indexOf("/login")>-1||window.location.pathname.indexOf("/signUp")>-1||window.location.pathname.indexOf("/onVerifyAction")>-1||window.location.pathname.indexOf("/resetPassword")>-1||window.location.pathname.indexOf("/forgotPassword")>-1||window.location.pathname.indexOf("/verifyemail")>-1||window.location.pathname.indexOf("/collabrator")>-1||window.location.pathname.indexOf("/productProfile")>-1||n.path("/login")}]),vgApp.filter("format",function(){return function(e){var t=e.split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5]).getTime()}}),vgApp.config(["NotificationProvider",function(e){e.setOptions({delay:2e3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"left",positionY:"top"})}]),vgApp.directive("scrollIf",function(e){return function(t,a,o){t.$watch(o.scrollIf,function(t){t&&e(a)})}}),vgApp.config(["$urlRouterProvider","$httpProvider",function(e,t){t.interceptors.push(["$injector","$state","$q","$rootScope",function(e,t,a,o){return{request:function(t){var n=a.defer();if(t.timeout=n.promise,o.er=!1,t.url.indexOf("api/")>-1){e.get("SystemService");if(t.url.indexOf("productstock/getuserstockinfo")>-1)o.er=!0;else if(t.url.indexOf("oauth/token")>-1||t.url.indexOf("users/adduser")>-1||t.url.indexOf("users/forgetPassword")>-1||t.url.indexOf("users/resetPassword")>-1||t.url.indexOf("token/checktoken")>-1||t.url.indexOf("users/validatetoken")>-1)t.url=t.url;else{var r=localStorage.getItem("access_token"),i=localStorage.getItem("userId");null==r||(t.url=t.url,t.headers.Authorization="Bearer "+r,t.headers.userid=i,t.headers.organisationid=o.orgId,t.headers.stockareaid=localStorage.getItem("selectedStockareaId"))}}return t},responseError:function(e){return a.reject(e)}}}])}]),vgApp.config(["$urlRouterProvider","$httpProvider",function(e,t){t.interceptors.push(["$injector","$location","$q","$rootScope",function(e,t,a,o){return{response:function(e){return e},responseError:function(e){switch(e.status){case 404:o.errormessage="Requested URL is not available",t.path("/login");break;case 401:t.path("/login");break;case 503:o.errormessage="Error occured in Server please try again after some time",t.path("/login");break;case 500:console.log("InternalServerError");break;case 625:console.log("inputserror");break;case 360:console.log("duplicateuser");break;case 385:console.log("duplicateemail");break;case 362:case 400:t.path("/login");break;case 403:console.log("passwordNotMatch");break;case 413:console.log("EmailNotverified");break;default:o.notify()}return a.reject(e)}}}])}]),vgApp.directive("monthpicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){var n={dateFormat:"mm/yy",onSelect:function(t){a=t,e.$apply(function(){o.$setViewValue(a)});var a}};t.datepicker(n)}}}),vgApp.directive("autogrow",function(){return{restrict:"A",link:function(e,t,a){t.css("overflow","hidden");e.$watch(a.ngModel,function(){!function(){t.css("height","auto");var e=t[0].scrollHeight;e>0&&t.css("height",e+"px")}()}),a.$set("ngTrim","false")}}}),vgApp.directive("datepicker",function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,o){var n={dateFormat:"dd/mm/yy",onSelect:function(t){a=t,e.$apply(function(){o.$setViewValue(a)});var a}};t.datepicker(n)}}});var domainURL=window.location.origin+"/";function setheightandwidthofmaincontainer(){var e,t=document.getElementsByClassName("tabcontents"),a=screen.height;if(a=window.innerHeight,0!=t.length){if(a>640){e=a-60-80-70-20,document.getElementById("map").style.height=e+"px",document.getElementById("mainsection").style.height=e+"px",document.getElementById("maindiv").style.height=e+"px",document.getElementById("settingdiv").style.height=e-53+"px",document.getElementById("productlistsectiondiv").style.height=e-140+"px",document.getElementById("productlistdiv").style.height=e-140+"px",document.getElementById("notification").style.height=a-75+"px";for(var o=t.length-1;o>=0;o--)t[o].style.height=e+"px";document.getElementsByClassName("searchresultdiv")[0].style.height=e-150+"px"}else{e=430,document.getElementById("map").style.height=e+"px",document.getElementById("mainsection").style.height=e+"px",document.getElementById("maindiv").style.height=e+"px",document.getElementById("settingdiv").style.height=e-53+"px",document.getElementById("productlistdiv").style.height=e-137+"px",document.getElementById("productlistsectiondiv").style.height=e-137+"px",document.getElementById("notification").style.height=e-60+"px";for(o=t.length-1;o>=0;o--)t[o].style.height=e+"px";document.getElementsByClassName("searchresultdiv")[0].style.height="350px"}null!==document.getElementById("productinfodiv")&&(document.getElementById("productinfodiv").style.height=e-131+"px"),null!==document.getElementById("branddiv")&&(document.getElementById("branddiv").style.height=e-131+"px"),null!==document.getElementById("addproduct")&&(document.getElementById("addproduct").style.height=e-53+"px"),null!==document.getElementById("searchresult")&&(document.getElementById("searchresult").style.height=e+"px"),null!==document.getElementById("editproduct")&&(document.getElementById("editproduct").style.height=e-131+"px");var n,r=window.innerWidth;r>800&&(n=r-279,document.getElementById("map").style.width=n+"px",document.getElementById("maindiv").style.width=n+"px",document.getElementById("mainsection").style.width=n+"px"),r<800&&(n=800,n=500,document.getElementById("maindiv").style.width=n+"px",document.getElementById("mainsection").style.width=n+"px",document.getElementById("mainsection").style.width=n+"px")}}setTimeout(function(){setheightandwidthofmaincontainer()},1e3),window.addEventListener("resize",function(){setheightandwidthofmaincontainer()}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),vgApp.factory("dashboardService",["$http",function(e){return{isAuthenticated:function(){return e({method:"POST",headers:{"Content-Type":"application/json"},data:{userId:localStorage.getItem("userId"),access_token:localStorage.getItem("access_token")},url:domainURL+"api/token/checktoken"}).then(function(e){return e},function(e){return e})},addpackage:function(t){return e({url:domainURL+"api/secured/package/addpackage",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},deletepackage:function(t){return e({url:domainURL+"api/secured/package/deletepackage",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},suggestpackage:function(t){return e({url:domainURL+"api/secured/package/suggestpackage",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},category:function(){return e({url:domainURL+"api/secured/unit/category",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},updatestockareavisiblity:function(t){return e({url:domainURL+"api/secured/stockarea/updatevisiblity",method:"POST",headers:{"Content-Type":"application/json"},data:{visiblity:t}}).then(function(e){return e},function(e){return e})},addcategory:function(t,a){return e({url:domainURL+"api/secured/unit/addcategory",method:"POST",headers:{"Content-Type":"application/json"},data:{categoryname:t,categorydescription:a}}).then(function(e){return e},function(e){return e})},addreport:function(t,a){return e({url:domainURL+"api/secured/report/addreport",method:"POST",headers:{"Content-Type":"application/json"},data:{productId:t,message:a}}).then(function(e){return e},function(e){return e})},types:function(){return e({url:domainURL+"api/secured/unit/types",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},stockareatypes:function(){return e({url:domainURL+"api/secured/unit/stockareatypes",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},units:function(){return e({url:domainURL+"api/secured/unit/units",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},derivedunits:function(){return e({url:domainURL+"api/secured/unit/derivedunits",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getsellbystockareaId:function(t,a){return e({url:domainURL+"api/secured/authorize/sell/getsellbystockareaId?stockareaId="+a+"&productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getnotification:function(){return e({url:domainURL+"api/secured/authorize/notification/getinfo",method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getmessages:function(){return e({url:domainURL+"api/secured/authorize/message/getinfo",method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},updatemessage:function(){return e({url:domainURL+"api/secured/authorize/message/update",method:"post",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},addmessage:function(t,a){return e({url:domainURL+"api/secured/authorize/message/addmessage",method:"post",headers:{"Content-Type":"application/json"},data:{message:t,to:a}}).then(function(e){return e},function(e){return e})},updatenotification:function(t){return e({url:domainURL+"api/secured/authorize/notification/updatenotification",method:"post",headers:{"Content-Type":"application/json"},data:{Id:t}}).then(function(e){return e},function(e){return e})},getbrands:function(t,a){return e({url:domainURL+"api/brand/autocomplete?term="+a,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getuserorginfo:function(t){return e({url:domainURL+"api/secured/authorize/organisation/getuserorginfo?term="+t,method:"GET",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},checkorgname:function(t){return e({url:domainURL+"api/secured/authorize/organisation/checkorganisation?term="+t,method:"GET",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},getbrandmaterialinfo:function(t,a){return e({url:domainURL+"api/secured/authorize/brandmaterial/getinfo?materialId="+t+"&brandId="+a,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},addproductlike:function(t){return e({url:domainURL+"api/secured/authorize/products/like",method:"post",headers:{"Content-Type":"application/json"},data:{productId:t}}).then(function(e){return e},function(e){return e})},removeproductlike:function(t){return e({url:domainURL+"api/secured/authorize/products/unlike",method:"post",headers:{"Content-Type":"application/json"},data:{productId:t}}).then(function(e){return e},function(e){return e})},addreview:function(t,a,o,n){return e({url:domainURL+"api/secured/authorize/brandmaterial/addreview",method:"post",headers:{"Content-Type":"application/json"},data:{materialId:t,brandId:a,message:n,review:o}}).then(function(e){return e},function(e){return e})},getstockareainfo:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/getstockareainfo?stockareaId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getallstockareas:function(){return e({url:domainURL+"api/secured/authorize/stockarea/getallstockareasofuser",method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getProductProfile:function(t,a){return e({url:domainURL+"api/productstock/getuserstockinfo?stockareaName="+t+"&productName="+a,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},updatesource:function(t,a,o){return e({url:domainURL+"api/secured/authorize/productstock/updatesource",method:"post",headers:{"Content-Type":"application/json"},data:{stockareaId:t,productId:a,sourceId:o}}).then(function(e){return e},function(e){return e})},codes:function(){return e({url:domainURL+"api/secured/users/getcodes",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},phonechange:function(t){return e({url:domainURL+"api/secured/users/checkphone",method:"POST",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},getUserDetails:function(){return e({url:domainURL+"api/secured/users/getuser",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},checkname:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/checkstockarea",method:"POST",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},getStockArea:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/getallstockareasofuser?orgId="+t,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e},function(e){return e})},getorganisation:function(t){return e({url:domainURL+"api/secured/authorize/organisation/getorganisation?orgId="+t,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e},function(e){return e})},deletecollabrator:function(t,a){return e({url:domainURL+"api/secured/authorize/organisation/deletecollabrator?stockareaId="+t+"&productId="+a,method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){return e},function(e){return e})},collabrator:function(t){return e({url:domainURL+"api/organisation/collabrator",method:"post",headers:{"Content-Type":"application/json"},data:{token:t}}).then(function(e){return e},function(e){return e})},ignore:function(t){return e({url:domainURL+"api/organisation/ignorecollabrator",method:"post",headers:{"Content-Type":"application/json"},data:{token:t}}).then(function(e){return e},function(e){return e})},addcollabrator:function(t,a,o,n,r,i){return e({url:domainURL+"api/secured/authorize/organisation/addcollabrator",method:"POST",headers:{"Content-Type":"application/json"},data:{orgId:t,organisationId:a,stockareaId:o,productId:n,initiatorproductstockId:r,productstockId:i}}).then(function(e){return e},function(e){return e})},addorg:function(t,a){return e({url:domainURL+"api/secured/authorize/organisation/addorganisation",method:"POST",headers:{"Content-Type":"application/json"},data:{organisationName:t,organisationId:a}}).then(function(e){return e},function(e){return e})},updateorg:function(t,a,o){return e({url:domainURL+"api/secured/authorize/organisation/updateorganisation",method:"POST",headers:{"Content-Type":"application/json"},data:{organisationId:t,organisationName:a,sin:o}}).then(function(e){return e},function(e){return e})},geturl:function(){return e({url:domainURL+"api/secured/users/geturl",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},brand:function(t){return e({url:domainURL+"api/secured/authorize/brand/Id",method:"POST",headers:{"Content-Type":"application/json"},data:{name:t}}).then(function(e){return e},function(e){return e})},brandinfo:function(t){return e({url:domainURL+"api/secured/authorize/brand/brandinfo?brandId="+t,method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getStockAreaProducts:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/getproductsofstockarea?userId="+t+"&stockareaId="+a,ContentType:"application/x-www-form-urlencoded",method:"GET",dataType:"json"}).then(function(e){return e},function(e){return e})},getprivateproducts:function(){return e({url:domainURL+"api/secured/authorize/products/getprivateproducts",ContentType:"application/x-www-form-urlencoded",method:"GET",dataType:"json"}).then(function(e){return e},function(e){return e})},addProductsToStcokarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/updateproducts",method:"POST",headers:{"Content-Type":"application/json"},data:{stockareaId:t,products:a}}).then(function(e){return e},function(e){return e})},postAddStockarea:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/addstockarea",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},updatestockarea:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/updatestockarea",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},addSell:function(t){return e({url:domainURL+"api/secured/authorize/sell/addsell",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},registerUser:function(t){return e({url:domainURL+"api/users/addUser",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},forgotPassword:function(t){return e({url:domainURL+"api/users/resetPassword",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},verifyToken:function(t){return e({url:domainURL+"api/users/onVerifyAction",method:"GET",headers:{"Content-Type":"application/json"},params:{token:t}}).then(function(e){return e},function(e){return e})},deleteStockarea:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/delete",method:"POST",headers:{"Content-Type":"application/json"},data:{stockareaId:t}}).then(function(e){return e},function(e){return e})},mapInfo:function(t,a,o){return e({url:domainURL+"api/secured/authorize/orders/getdestinationsforproduct",method:"POST",headers:{"Content-Type":"application/json"},ignoreLoadingBar:!0,data:{stockareaId:a,productId:t,position:o}}).then(function(e){return e},function(e){return e})},productInfo:function(t,a){return e({url:domainURL+"api/secured/authorize/products/getproductinfobyid?productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getProductStockInfo:function(t,a){return e({url:domainURL+"api/secured/authorize/productstock/getproductstockinfo?stockareaId="+a+"&productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},movetovg:function(t){return e({url:domainURL+"api/secured/authorize/products/movetovg?productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getProductSellInfo:function(t,a){return e({url:domainURL+"api/secured/authorize/productstock/getsellinfo?stockareaId="+a+"&productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getsell:function(t,a){return e({url:domainURL+"api/secured/authorize/sell/getsell?productstockId="+a+"&productId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},stockareaInfo:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/getstockarea?userId="+localStorage.getItem("userId")+"&stockareaId="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},getSearchProductsbycategory:function(t){return e({url:domainURL+"api/secured/authorize/products/getSearchProductsbycategory?id="+t,method:"get",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},addproduct:function(t,a,o,n,r,i,c,s,l,d,u){return e({url:domainURL+"api/secured/authorize/products/addproduct",method:"post",headers:{"Content-Type":"application/json"},data:{productname:t,productcategory:a,producttype:o,productdescription:n,productbrand:r,orgId:i,pics:c,packages:s,specifications:l,links:d,newvariant:u}}).then(function(e){return e},function(e){return e})},addbrand:function(t,a,o,n,r){return e({url:domainURL+"api/secured/authorize/brand/addbrand",method:"post",headers:{"Content-Type":"application/json"},data:{brandname:t,brandowner:a,brandtype:o,branddescription:n,logo:r}}).then(function(e){return e},function(e){return e})},updatebrand:function(t,a,o,n){return e({url:domainURL+"api/secured/authorize/brand/editbrand",method:"post",headers:{"Content-Type":"application/json"},data:{brandId:t,brandname:a,branddescription:o,logo:n}}).then(function(e){return e},function(e){return e})},updateproduct:function(t,a,o,n,r,i,c,s,l){return e({url:domainURL+"api/secured/authorize/products/updateproduct",method:"post",headers:{"Content-Type":"application/json"},data:{productId:t,productname:a,productcategory:o,producttype:n,productdescription:r,pics:c,brand:i,specifications:s,links:l}}).then(function(e){return e},function(e){return e})},getSearchProductsInfo:function(t){return e({url:domainURL+"api/secured/authorize/products/getproducts",method:"get",headers:{"Content-Type":"application/json"},params:t}).then(function(e){return e},function(e){return e})},getSearchBrandsInfo:function(t){return e({url:domainURL+"api/secured/authorize/brand/getbrands",method:"get",headers:{"Content-Type":"application/json"},params:t}).then(function(e){return e},function(e){return e})},logout:function(t,a){return e({url:domainURL+"api/secured/token/logout",method:"get",headers:{"Content-Type":"application/json"},data:{userId:t,access_token:a}}).then(function(e){return e},function(e){return e})},deleteProduct:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/deleteproduct",method:"POST",headers:{"Content-Type":"application/json"},data:{stockareaId:t,productId:a}}).then(function(e){return e},function(e){return e})},renameStockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/rename",method:"post",headers:{"Content-Type":"application/json"},data:{stockareaId:a,stockareaName:t}}).then(function(e){return e},function(e){return e})},updatePassword:function(t){return e({url:domainURL+"api/secured/users/updatePassword",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})}}}]),vgApp.factory("loginService",["$http",function(e){return{authenticateUser:function(t,a){return e({url:domainURL+"api/token/login",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},data:{username:t,password:a,client_id:"$vgodown1",client_secret:"grnklnio576543hyjvbk",grant_type:"password"}}).then(function(e){return e},function(e){return e})},material:function(t){return e({method:"POST",headers:{"Content-Type":"application/json"},url:domainURL+"api/material/Id",data:{name:t}}).then(function(e){return e},function(e,t,a){return a})},addsuggest:function(t,a){return e({method:"POST",headers:{"Content-Type":"application/json"},url:domainURL+"api/suggest/suggestproduct",data:{materialId:t,filters:a}}).then(function(e){return e},function(e,t,a){return a})},registerUser:function(t){return e({url:domainURL+"api/users/adduser",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},signUpComplete:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/addstockarea",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},forgotPassword:function(t){return e({url:domainURL+"api/users/forgetPassword",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},verifyToken:function(t){return e({url:domainURL+"api/users/onVerifyAction",method:"post",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},collabrator:function(t){return e({url:domainURL+"api/organisation/collabrator",method:"post",headers:{"Content-Type":"application/json"},data:{token:t}}).then(function(e){return e},function(e){return e})},validatetoken:function(t){return e({url:domainURL+"api/users/validatetoken",method:"post",headers:{"Content-Type":"application/json"},data:{token:t}}).then(function(e){return e},function(e){return e})},isAuthenticated:function(){return e({method:"POST",headers:{"Content-Type":"application/json"},data:{userId:localStorage.getItem("userId"),access_token:localStorage.getItem("access_token")},url:domainURL+"api/token/checktoken"}).then(function(e){return e},function(e){return e})},updatePassword:function(t){return e({url:domainURL+"api/secured/users/updatePassword",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},checkname:function(t){return e({url:domainURL+"api/secured/authorize/stockarea/checkstockarea",method:"POST",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},codes:function(){return e({url:domainURL+"api/secured/users/getcodes",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},deleteuser:function(t){return e({url:domainURL+"api/secured/users/deleteuser",method:"POST",headers:{"Content-Type":"application/json"},data:{password:t}}).then(function(e){return e},function(e){return e})},emailchange:function(t){return e({url:domainURL+"api/users/checkemail",method:"POST",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},useridchange:function(t){return e({url:domainURL+"api/users/checkuserid",method:"POST",headers:{"Content-Type":"application/json"},data:{userid:t}}).then(function(e){return e},function(e){return e})},phonechange:function(t){return e({url:domainURL+"api/secured/users/checkphone",method:"POST",headers:{"Content-Type":"application/json"},data:{term:t}}).then(function(e){return e},function(e){return e})},getUserDetails:function(){return e({url:domainURL+"api/secured/users/getuser",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},geturl:function(){return e({url:domainURL+"api/secured/users/geturl",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},updateprofile:function(t){return e({url:domainURL+"api/secured/users/update",method:"POST",headers:{"Content-Type":"application/json"},data:t}).then(function(e){return e},function(e){return e})},gethistory:function(){return e({url:domainURL+"api/secured/authorize/history/gethistory",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},gethistoryview:function(){return e({url:domainURL+"api/secured/authorize/history/gethistoryview",method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e},function(e){return e})},updatepassword:function(t,a){return e({url:domainURL+"api/secured/users/updatepassword",method:"POST",headers:{"Content-Type":"application/json"},data:{oldPassword:t,newPassword:a}}).then(function(e){return e},function(e){return e})},addprimary:function(t){return e({url:domainURL+"api/secured/users/addprimary",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t}}).then(function(e){return e},function(e){return e})},addprimarymobile:function(t){return e({url:domainURL+"api/secured/users/addprimarymobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t}}).then(function(e){return e},function(e){return e})},addprimarystockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/primaryemail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t,stockareaId:a}}).then(function(e){return e},function(e){return e})},addprimarymobilestockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/primarymobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t,stockareaId:a}}).then(function(e){return e},function(e){return e})},updateprofilepic:function(t){return e({url:domainURL+"api/secured/users/updateprofilepic",method:"POST",headers:{"Content-Type":"application/json"},data:{img:t}}).then(function(e){return e},function(e){return e})},addsecondary:function(t){return e({url:domainURL+"api/secured/users/addsecondary",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t}}).then(function(e){return e},function(e){return e})},deleteemail:function(t){return e({url:domainURL+"api/secured/users/deleteemail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t}}).then(function(e){return e},function(e){return e})},deletemobile:function(t){return e({url:domainURL+"api/secured/users/deletemobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t}}).then(function(e){return e},function(e){return e})},deleteemailstockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/deleteemail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t,stockareaId:a}}).then(function(e){return e},function(e){return e})},deletemobilestockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/deletemobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t,stockareaId:a}}).then(function(e){return e},function(e){return e})},verify:function(t){return e({url:domainURL+"api/secured/users/verify",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t}}).then(function(e){return e},function(e){return e})},verifymobile:function(t){return e({url:domainURL+"api/secured/users/verifymobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t}}).then(function(e){return e},function(e){return e})},submitotp:function(t){return e({url:domainURL+"api/secured/users/verifymobileotp",method:"POST",headers:{"Content-Type":"application/json"},data:{token:t}}).then(function(e){return e},function(e){return e})},verifyemail:function(t,a){return e({url:domainURL+"api/users/verifyemail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:a,token:t}}).then(function(e){return e},function(e){return e})},addnewmail:function(t){return e({url:domainURL+"api/secured/users/addnewmail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t}}).then(function(e){return e},function(e){return e})},addnewmobile:function(t,a){return e({url:domainURL+"api/secured/users/addnewmobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t,code:a}}).then(function(e){return e},function(e){return e})},addnewmobilestockarea:function(t,a,o){return e({url:domainURL+"api/secured/authorize/stockarea/addnewmobile",method:"POST",headers:{"Content-Type":"application/json"},data:{mobile:t,code:a,stockareaId:o}}).then(function(e){return e},function(e){return e})},addnewmailstockarea:function(t,a){return e({url:domainURL+"api/secured/authorize/stockarea/addnewemail",method:"POST",headers:{"Content-Type":"application/json"},data:{email:t,stockareaId:a}}).then(function(e){return e},function(e){return e})},updateorganisation:function(t,a,o,n){return e({url:domainURL+"api/secured/users/updateorganisation",method:"POST",headers:{"Content-Type":"application/json"},data:{name:t,as:a,from:o,to:n}}).then(function(e){return e},function(e){return e})},editorganisation:function(t,a,o,n,r){return e({url:domainURL+"api/secured/users/editorganisation",method:"POST",headers:{"Content-Type":"application/json"},data:{id:t,name:a,as:o,from:n,to:r}}).then(function(e){return e},function(e){return e})},deleteorganisation:function(t){return e({url:domainURL+"api/secured/users/deleteorganisation",method:"POST",headers:{"Content-Type":"application/json"},data:{id:t}}).then(function(e){return e},function(e){return e})}}}]),vgApp.service("SystemService",["localStorageService",function(e){var t={serviceName:"/virtualgodown",authServiceName:"/virtualgodown"};this.getCurrentInstance=function(){return t},this.getCurrentAccessToken=function(){return e.get("accessToken")},this.getCurrentUserId=function(){return e.get("userId")}}]),vgApp.controller("addbrandController",["$uibModal","$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$q","category","$uibModalInstance",function(e,t,a,o,n,r,i,c,s,l,d){t.productcategry="brand",t.productcategory="510dsfd89ejofiw9eojfw01343fe35tfw",t.search=null,i.newvariant="false",t.pictures=[],t.productimages=[],t.producttype=1001,t.productmaterials=[],t.referenceproducts=[{product:""}],t.productdescription=[{key:"",value:""}],t.addproductdescription=function(){t.productdescription.push({key:"",value:""})},t.removeproductdescription=function(){t.productdescription.pop()},t.addbrand=function(){e.open({templateUrl:"views/dashboard/addbrand.html",controller:"addproductinfoController",size:"md",resolve:{category:function(){return"brand"}}}).result.then(function(e){},function(e){})},t.close=function(){d.dismiss("cancel")},a.category().then(function(e){t.category=e.data}),t.unt="false",t.brd="false",t.link="false",t.setproductunit=function(e,a){console.log(e),t.punit=a,t.productunit=e,$("#unit").removeClass("open")},t.brdtrue=function(){t.brd="true"},t.brd1=function(){t.brd="false"},t.addproductlink=function(){t.referenceproducts.push({product:""})},t.removeproductlink=function(e){t.referenceproducts.pop()},t.testbrand=function(){return"true"!=t.brd||!(!t.brand||null==t.brand||void 0==t.brand)},t.testlinks=function(){return"true"!=t.link||t.referenceproducts.length==t.productmaterials.length},t.resize=function(e){e&&e.target&&void 0!=e.target&&(e.target.style.height=e.target.scrollHeight+"px")},t.deleteproductimage=function(e){var a=t.productimages.indexOf(e);t.productimages.splice(a,1)},t.brandautocomplete=function(){$("#brandautocompletesearch").autocomplete({source:function(e,t){r({url:domainURL+"api/brand/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){0==e.data.data.length?t($.map(e.data.data,function(e){return{label:"add a new brand"}})):t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,Id:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){"add a new brand"==a.item.label?t.addbrand():(t.brand=a.item.Id,t.branderror="false")}})},t.categoryautocomplete=function(){$("#categoryautocomplete").autocomplete({source:function(e,a){a($.map(t.category,function(e){return{label:e.name,value:e.name,Id:e._id}}))},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){t.productcategory=a.item.Id}})},t.productautocomplete=function(){$("#productautocomplete").autocomplete({source:function(e,t){r({url:domainURL+"api/secured/authorize/products/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,Id:e._id,specifications:e.specifications}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){t.setmaterial(a.item.Id)}})},t.setmaterial=function(e){t.productmaterials.push({productId:e})},t.testbrand=function(){return"true"!=t.brd||!(!t.brand||null==t.brand||void 0==t.brand)},t.testlinks=function(){return"true"!=t.link||t.referenceproducts.length==t.productmaterials.length},t.addproduct=function(){if(null!=t.productname&&""!=t.productname&&null!=t.productcategory&&""!=t.productcategory&&t.testlinks()&&t.testbrand()){t.pictures=[];if(0==t.productimages.length){t.spec=t.productdescription;a.addproduct(t.productname,t.productcategory,t.producttype,t.productdescription,t.brand,i.orgId,t.pictures,["a0e21c0-827b-11e7-bc65-2f4af1bcac66"],t.spec,t.productmaterials,t.newvariant).then(function(e){"200"==e.data.code?(n.success("brand added successfully"),d.dismiss({status:"success",id:e.data.data._id,name:e.data.data.productName})):n.error(e.data.message)},function(e){n.error("error adding product")})}else for(var e=0;e<t.productimages.length;e++)e==t.productimages.length-1?a.geturl().then(function(e){t.pictures.push({img:e.data.url}),t.uploadproductimg1(t.productimages[t.productimages.length-1].img,e.data.name,e.data.signed_request),t.addproductinfo()}):t.uploadproductimg(t.productimages[e].img)}else{var o;null!=t.productname&&""!=t.productname||(t.productname="",o="<div>Asset name is required.</div> "),null!=t.productcategory&&""!=t.productcategory||(t.productcategory="",o+="<div>Asset category is required.</div> "),t.testlinks()||(o+="<div>Asset you are trying to link is not in our system. please select the existing one or create a product for it.</div> "),t.testbrand()||(t.branderror="true",o+="<div>Brand you trying to link to your product is not in our system. please add brand in our system before including it.</div> "),n.error({message:o,positionY:"top",positionX:"center",delay:2e3,verticalSpacing:1500,horizontalSpacing:50})}},t.addproductinfo=function(){t.spec=t.productdescription;a.addproduct(t.productname,t.productcategory,t.producttype,t.productdescription,t.brand,i.orgId,t.pictures,["a0e21c0-827b-11e7-bc65-2f4af1bcac66"],t.spec,t.productmaterial,t.newvariant).then(function(e){"200"==e.data.code?(n.success("product added successfully"),d.dismiss({status:"success",id:e.data.data._id,name:e.data.data.productName})):n.error(e.data.message)},function(e){n.error("error adding product")})},t.uploadproductimg=function(e){a.geturl().then(function(a){return t.pictures.push({img:a.data.url}),t.urltoFile(e,a.data.name+".jpg","image/jpeg").then(function(e){var t=e;$.ajax({type:"PUT",data:t,url:a.data.signed_request,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})}),!0})},t.uploadproductimg1=function(e,a,o){return t.urltoFile(e,a+".jpg","image/jpeg").then(function(e){var t=e;$.ajax({type:"PUT",data:t,url:o,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})}),!0},t.myCroppedImage="",t.myFile="",$("#fileInput").change(function(){t.newup=!0}),t.uploadnewprofile=function(){t.newup=!0},t.uploadFile=function(e){if(e){var a=new FileReader;a.onload=function(e){t.$apply(function(t){t.myImage=e.target.result})},t.newup=!0,a.readAsDataURL(e)}},t.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},t.productimages=[],t.uploadimg=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show(),t.productimages.push({img:t.myCroppedImage}),t.newup=!1},t.height=function(){var e,o=screen.height;(o=window.innerHeight)>640?(e=o-60-80-70-20,document.getElementById("addproduct").style.height=e-53+"px"):(e=430,document.getElementById("addproduct").style.height=e-53+"px"),a.getbrands().then(function(e){t.brands=e.data.data,201==i.orgstatus?t.productOwner=i.fullName:t.productOwner=i.orgname+"("+i.fullName+")"},function(e){n.error("cannot able to load brands")})}}]),vgApp.controller("addcollabratorctrl",["$scope","dashboardService","$uibModalInstance","$timeout","$uibModal","Notification","$http","$rootScope",function(e,t,a,o,n,r,i,c){e.autoc=!0,e.close=function(){a.dismiss("cancel")},e.getSearchusers=function(t,a){e.Id=t},e.stockareaautocomplete=function(){$("#stockareaautocompletesearch").autocomplete({source:function(t,a){i({url:domainURL+"api/secured/authorize/stockarea/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:t.term,productId:c.productId}}).then(function(t){e.listsareas=t.data.data,a($.map(t.data.data,function(e){return 201==e.organisationId.status?{label:e.stockareaName,value:e.stockareaName,Id:e._id}:{label:e.stockareaName,value:e.stockareaName,org:e.organisationId.organisationId,Id:e._id}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.autoc=!1,e.collabratorId=a.item.org,e.collabratorstockareaId=a.item.Id,console.log("success")}})},e.add=function(){t.getProductStockInfo(c.productId,e.collabratorstockareaId).then(function(o){t.addcollabrator(c.orgId,e.collabratorId,e.collabratorstockareaId,c.productId,c.productstockId,o.data.data._id).then(function(e){"200"==e.data.code?(r.success("successfully mail sent to the collabrator"),a.close("done")):r.error(e.data.message)},function(e){r.error(e.data.message)})})}}]),vgApp.controller("packagectrl",["$sce","$scope","dashboardService","productid","$uibModalInstance","$state","$timeout","$uibModal","$rootScope","Notification","$log",function(e,t,a,o,n,r,i,c,s,l,d){t.close=function(){n.dismiss("cancel")},t.punit="unit",a.units().then(function(e){t.units=e.data,t.productunit=t.units[0]._id}),a.derivedunits().then(function(e){t.derivedunits=e.data,console.log(t.derivedunits)}),t.setproductunit=function(e,a){console.log(e),t.punit=a,t.productunit=e,$("#unit").removeClass("open")},t.submit=function(){var e={productId:o,packagesize:t.packagesize,packageshape:t.packageshape,packagetype:t.packagetype,unit:t.punit};t.packagesize&&t.punit?a.addpackage(e).then(function(e){l.success("package details updated successfully"),n.close("done")},function(e){l.error("Error adding package")}):(t.packagesize||l.error("package size is required"),t.punit||l.error("package unit is required"))}}]),vgApp.controller("suggestpackagectrl",["$sce","$scope","dashboardService","productid","$uibModalInstance","$state","$timeout","$uibModal","$rootScope","Notification","$log",function(e,t,a,o,n,r,i,c,s,l,d){t.close=function(){n.dismiss("cancel")},t.punit="unit",a.units().then(function(e){t.units=e.data,t.productunit=t.units[0]._id}),a.derivedunits().then(function(e){t.derivedunits=e.data,console.log(t.derivedunits)}),t.setproductunit=function(e,a){console.log(e),t.punit=a,t.productunit=e,$("#unit").removeClass("open")},t.submit=function(){var e={productId:o,packagesize:t.packagesize,packageshape:t.packageshape,packagetype:t.packagetype,unit:t.punit};t.packagesize&&t.punit?a.suggestpackage(e).then(function(e){l.success("package details updated successfully"),n.close("done")},function(e){l.error("Error adding package")}):(t.packagesize||l.error("package size is required"),t.punit||l.error("package unit is required"))}}]),vgApp.controller("addproductController",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$q",function(e,t,a,o,n,r,i,c){e.search=null,r.newvariant="false",i.go("home.addproduct.addproductinfo"),e.createtab=function(){"brand"==e.newvariant?i.go("home.addproduct.addbrand"):i.go("home.addproduct.addproductinfo")},e.height=function(){var a,n=screen.height;(n=window.innerHeight)>640?(a=n-60-80-70-20,document.getElementById("addproduct").style.height=a-53+"px"):(a=430,document.getElementById("addproduct").style.height=a-53+"px"),t.getbrands().then(function(t){e.brands=t.data.data,201==r.orgstatus?e.productOwner=r.fullName:e.productOwner=r.orgname+"("+r.fullName+")"},function(e){o.error("cannot able to load brands")})}}]),vgApp.controller("addproductinfoController",["$sce","$uibModal","$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$q",function(e,t,a,o,n,r,i,c,s,l){a.search=null,c.newvariant="false",a.pictures=[],a.productimages=[],a.producttype=1001,a.productmaterials=[],a.referenceproducts=[{product:""}],a.changedescription=function(t){void 0==t.value&&(t.value=" "),a.htmlTextToolTip=e.trustAsHtml('<font style="word-wrap:break-word;width:300px !important;height:200px !important;font-weight:100;overflow:auto;" class="packageNameTooltip">'+t.value+"</font>")},a.addbrand=function(){t.open({templateUrl:"views/dashboard/addbrand.html",controller:"addbrandController",size:"md",resolve:{category:function(){return"brand"}}}).result.then(function(e){a.brand="",a.brnd=""},function(e){"success"==e.status?(a.brand=e.id,document.getElementById("brandautocompletesearch").value=e.name):(a.brand="",a.brnd="")})},a.createtab=function(){"brand"==a.newvariant?s.go("home.addproduct.addbrand"):"category"==a.newvariant?s.go("home.addproduct.addcategory"):s.go("home.addproduct.addproductinfo")},o.category().then(function(e){a.category=e.data}),a.unt="false",a.brd="false",a.link="false",a.setproductunit=function(e,t){console.log(e),a.punit=t,a.productunit=e,$("#unit").removeClass("open")},a.brdtrue=function(){a.brd="true"},a.brd1=function(){a.brd="false"},a.addproductlink=function(){a.referenceproducts.push({product:""})},a.removeproductlink=function(e){a.referenceproducts.pop()},a.testbrand=function(){return"true"!=a.brd||!(!a.brand||null==a.brand||void 0==a.brand)},a.testlinks=function(){return"true"!=a.link||a.referenceproducts.length==a.productmaterials.length},a.resize=function(e){e&&e.target&&void 0!=e.target&&(e.target.style.height=e.target.scrollHeight+"px")},a.cancel=function(){s.go("home.virtualgodown")},a.deleteproductimage=function(e){var t=a.productimages.indexOf(e);a.productimages.splice(t,1)},a.brandautocomplete=function(){$("#brandautocompletesearch").autocomplete({source:function(e,t){i({url:domainURL+"api/brand/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){0==e.data.data.length&&e.data.data.push({productName:"add a new brand"}),t($.map(e.data.data,function(e){return"add a new brand"==e.productName?{label:e.productName}:{label:e.productName,value:e.productName,Id:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,t){"add a new brand"==t.item.label?a.addbrand():(a.brand=t.item.Id,a.branderror="false")}})},a.categoryautocomplete=function(e){for(var t=0;t<a.category.length;t++)a.category[t]._id==e&&(a.productcategry=a.category[t].name)},a.productautocomplete=function(){$("#productautocomplete").autocomplete({source:function(e,t){i({url:domainURL+"api/secured/authorize/products/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,Id:e._id,specifications:e.specifications}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,t){a.productmaterials.push({productId:Id})}})},a.setmaterial=function(e){a.productmaterials.push({productId:e})},a.addproduct=function(){if(null!=a.productname&&""!=a.productname&&null!=a.productcategory&&""!=a.productcategory&&a.testlinks()&&a.testbrand()){a.pictures=[];if(0==a.productimages.length){a.spec=a.productdescription;o.addproduct(a.productname,a.productcategory,a.producttype,a.productdescription,a.brand,c.orgId,a.pictures,["a0e21c0-827b-11e7-bc65-2f4af1bcac66"],a.spec,a.productmaterials,a.newvariant).then(function(e){"200"==e.data.code?(s.go("home.virtualgodown"),r.success("product added successfully")):r.error(e.data.message)},function(e){r.error("error adding product")})}else for(var e=0;e<a.productimages.length;e++)e==a.productimages.length-1?o.geturl().then(function(e){a.pictures.push({img:e.data.url}),a.uploadproductimg1(a.productimages[a.productimages.length-1].img,e.data.name,e.data.signed_request),a.addproductinfo()}):a.uploadproductimg(a.productimages[e].img)}else{var t;null!=a.productname&&""!=a.productname||(a.productname="",t="<div>Asset name is required.</div> "),null!=a.productcategory&&""!=a.productcategory||(a.productcategory="",t+="<div>Asset category is required.</div> "),a.testlinks()||(t+="<div>Asset you are trying to link is not in our system. please select the existing one or create a product for it.</div> "),a.testbrand()||(a.branderror="true",t+="<div>Brand you trying to link to your product is not in our system. please add brand in our system before including it.</div> "),r.error({message:t,positionY:"top",positionX:"center",delay:2e3,verticalSpacing:1500,horizontalSpacing:50})}},a.addproductinfo=function(){a.spec=a.productdescription;o.addproduct(a.productname,a.productcategory,a.producttype,a.productdescription,a.brand,c.orgId,a.pictures,["a0e21c0-827b-11e7-bc65-2f4af1bcac66"],a.spec,a.productmaterial,a.newvariant).then(function(e){"200"==e.data.code?(s.go("home.virtualgodown"),r.success("product added successfully")):r.error(e.data.message)},function(e){r.error("error adding product")})},a.uploadproductimg=function(e){o.geturl().then(function(t){return a.pictures.push({img:t.data.url}),a.urltoFile(e,t.data.name+".jpg","image/jpeg").then(function(e){var a=e;$.ajax({type:"PUT",data:a,url:t.data.signed_request,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})}),!0})},a.uploadproductimg1=function(e,t,o){return a.urltoFile(e,t+".jpg","image/jpeg").then(function(e){var t=e;$.ajax({type:"PUT",data:t,url:o,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})}),!0},a.myCroppedImage="",a.myFile="",$("#fileInput").change(function(){a.newup=!0}),a.uploadnewprofile=function(){a.newup=!0},a.uploadFile=function(e){if(e){var t=new FileReader;t.onload=function(e){a.$apply(function(t){t.myImage=e.target.result})},a.newup=!0,t.readAsDataURL(e)}},a.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},a.productimages=[],a.uploadimg=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show(),a.productimages.push({img:a.myCroppedImage}),a.newup=!1},a.height=function(){var e,t=screen.height;(t=window.innerHeight)>640?(e=t-60-80-70-20,document.getElementById("addproduct").style.height=e-53+"px"):(e=430,document.getElementById("addproduct").style.height=e-53+"px"),o.getbrands().then(function(e){a.brands=e.data.data,201==c.orgstatus?a.productOwner=c.fullName:a.productOwner=c.orgname+"("+c.fullName+")"},function(e){r.error("cannot able to load brands")})}}]),vgApp.controller("addStockareaCtrl",["$scope","$uibModalInstance","stockareaid","productid","$state","dashboardService","$timeout","$uibModal","$rootScope","scope","Notification",function(e,t,a,o,n,r,i,c,s,l,d){e.readname=!1,e.adrs=!1;r.stockareatypes().then(function(t){e.types=t.data,e.stockareavisiblity=e.types[0]._id}),r.codes().then(function(t){e.codes=t.data.data.code,e.code="+91"}),e.myregex=/[a-zA-Z0-9-]+/,e.space=function(){d.error("space is not allowed")},s.highlightcollabrator=null;new google.maps.StyledMapType([{elementType:"geometry.fill",stylers:[{color:"#e6e6e6"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",elementType:"geometry.fill",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#cfcfcf"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"administrative.province",elementType:"geometry.fill",stylers:[{color:"#e6e6e6"},{weight:1.5}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#cccccc"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#eeeeee"},{visibility:"off"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#757575"},{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b7e1ef"},{weight:2.5}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#b3b3b3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],{name:"Styled Map"}),new google.maps.Geocoder({region:"IN"});t.rendered.then(function(){var t=[],a=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(22.745154893908804,78.25780350000002),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});google.maps.event.trigger(a,"resize");var o=new google.maps.Marker({position:{lat:22.745154893908804,lng:78.25780350000002},draggable:!0,optimized:!1,map:a});t.push(o),google.maps.event.addListener(o,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(o,"click",function(t){displayPosition(e,this.getPosition())});var n=document.getElementById("searchmap");a.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var r=new google.maps.places.SearchBox(n);google.maps.event.addListener(r,"places_changed",function(){var o=r.getPlaces();if(0!=o.length){for(var n,i=0;n=t[i];i++)n.setMap(null);t=[];var c,s=new google.maps.LatLngBounds;for(i=0;c=o[i];i++){c.icon,new google.maps.Size(71,71),new google.maps.Point(0,0),new google.maps.Point(17,34),new google.maps.Size(25,25);a.setOptions({minZoom:1,maxZoom:16}),a.set({zoom:3}),n=new google.maps.Marker({draggable:!0,map:a,title:c.name,optimized:!1,position:c.geometry.location}),displayPosition(e,c.geometry.location),google.maps.event.addListener(n,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(n,"click",function(t){displayPosition(e,this.getPosition())}),t.push(n),s.extend(c.geometry.location)}a.fitBounds(s)}}),google.maps.event.addListener(a,"bounds_changed",function(){var e=a.getBounds();r.setBounds(e)})});e.stockareaid=a,e.productid=o,e.close=function(){"pending"!==s.userstatus&&t.dismiss("cancel")},e.checkname=function(){null==e.stockareaName||void 0==e.stockareaName.length?(e.na="stockarea name is required",e.state=null):e.stockareaName.length>2?(e.na=null,r.checkname(e.stockareaName).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.state="exist":e.state="Not exist!"})):(e.na=null,e.state=null)},e.latc=function(){null==e.latitude?e.lat="This feild is required":e.lat=null},e.lonc=function(){null==e.longitude?e.lon="This feild is required":e.lon=null},e.addc=function(){null==e.address&&(e.add="This feild is required")},e.namec=function(){null==e.stockareaName&&(e.na="stockarea name is required")},e.phc=function(){null==e.phone&&(e.ph="Phone number is required")},e.phonechange=function(){null==e.phone?(e.ph="Phone number is required",e.phonestate=null):(e.ph=null,r.phonechange(e.phone).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.phonestate="exist":e.phonestate="Not exist!"}))},e.fnAddStockarea=function(){var a={stockareaName:e.stockareaName,latitude:e.latitude,longitude:e.longitude,phone:e.phone,code:e.code,visiblity:e.stockareavisiblity,organisationId:s.orgId};null!==e.stockareaName&&null!==e.latitude&&null!==e.longitude&&null!==e.phone&&0==e.exist&&void 0!==e.stockareaName&&void 0!==e.latitude&&void 0!==e.longitude&&void 0!==e.phone?r.postAddStockarea(a).then(function(e){"200"==e.data.code?(l.tab=1,t.close(e,"done")):d.error(e.data.message)},function(e){d.error("Error creating stockarea!"),$log.info("Stockarea Not Added")}):(null!=e.stockareaName&&void 0!=e.stockareaName||(e.na="stockarea name required"),null===e.latitude&&null===e.longitude||d.error(" please select a location "),null==e.phone&&(e.phonestate=null,e.ph="Phone number is required"))}}]),vgApp.controller("createorgctrl",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$window",function(e,t,a,o,n,r,i,c){r.highlightcollabrator=null,e.edit=function(){e.editorg=!1},e.checkorgname=function(){null==e.organisationId||void 0==e.organisationId.length?(e.na="organisation name is required",e.state=null):e.organisationId.length>2?(e.na=null,t.checkorgname(e.organisationId).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.state="exist":e.state="Not exist!"})):(e.na=null,e.state=null)},e.new=function(){e.editorg=!1,e.organisationName=null,e.sin=null,e.Id=null},e.cancel=function(){i.go("home.virtualgodown")},e.add=function(){"exist"==e.state&&null!==e.organisationName&&null!==e.organisationId?t.addorg(e.organisationName,e.organisationId).then(function(t){"200"==t.data.code?(o.success("organisation created successfully"),localStorage.setItem("orgId",e.organisationId),c.location.replace("/")):o.error(t.data.message)},function(e){o.error("organisation create error")}):(null==e.organisationName&&(e.organisationName=""),null==e.organisationId&&(e.organisationId=""))}}]);function showArrays(e,t,a,o,n,r,i){for(var c=[],s=0;s<a.length;s++){var l;t.no==s?(l="#42f44e",i.tradeCost=r[s].Cost,i.tradeSourceId=n[s]):l="#bbc9c7",c[s]=new google.maps.Polyline({path:a[s],strokeColor:l,strokeOpacity:.6,strokeWeight:0,id:n[s],no:s,tradeinfo:r[s]}),c[s].setMap(o)}}vgApp.controller("homeController",["$scope","dashboardService","$log","Notification","$uibModal","$rootScope","$http","$window","$state","$sce","loginService","$stateParams",function(e,t,a,o,n,r,i,c,s,l,d,u){r.info=null,e.trade=!1,e.firstRate=0,r.indexloader="false",e.myFile=null,e.tab=u.tab,r.checktab=function(t,a){e.tab=6,e.notificationselectStockarea(t),r.productId=a},r.notify=function(){o.clearAll(),o.error({message:'<div style="display:inline-block;"><i style="color:white" class="fa fa-warning"></i> It seems you have a connectivity issue</div><font ng-click="closeAll()" style="float:right;margin-left:20px;display:inline-block">X</font>',positionY:"top",positionX:"center",delay:1e13,verticalSpacing:150,horizontalSpacing:50})},e.editproduct=function(t){s.go("home.editproduct",{productId:t}),e.tab=5},e.myCroppedImage="",e.myImage="",e.searchtype="product",e.subtab13=function(t){e.subtab1=3,document.getElementById("searchresult").style.display="none",e.selectedtab11="inactive",e.selectedtab12="inactive",e.selectedtab13="active";for(var a=0;a<e.productsSearch.length;a++)e.productsSearch[a].productId==t&&(e.privateproductId=t,e.productOwner=e.productsSearch[a].productOwner,e.productname=e.productsSearch[a].productName,e.productdescription=e.productsSearch[a].specifications,e.productcategory=e.productsSearch[a].categoryId,e.producttype=e.productsSearch[a].categoryId,e.productimages=e.productsSearch[a].images)};r.fly=function(){screen.width;$(".messagefly").css("display","block"),function(e,t){e.width();e.animate({top:"5%",right:"7.5%"},t)}($(".messagefly"),1e3),function(e,t){e.width();e.animate({top:"100%"},t)}($(".messagefly"),800),$(".messagefly").css("right","none"),$(".messagefly").css("top","none"),$(".messagefly").removeAttr("style")},e.sellbuttontip=function(){$(".stockaredetailssellbutton").tooltip("show")},e.createproduct=function(t){e.subtab1=3,s.go("home.addproduct")},e.subtab12=function(){document.getElementById("searchresult").style.display="none",e.subtab1=2,e.selectedtab11="inactive",e.selectedtab12="active",e.selectedtab13="inactive"},e.subtab11=function(){document.getElementById("searchresult").style.display="none",e.subtab1=1,e.selectedtab11="active",e.selectedtab12="inactive",e.selectedtab13="inactive"},e.subtab1=function(){e.subtab=1,e.selectedtab1="active",e.selectedtab2="inactive",e.selectedtab3="inactive"},e.subtab3=function(){e.subtab=3,e.selectedtab1="inactive",e.selectedtab2="inactive",e.selectedtab3="active"},e.subtab2=function(){e.subtab=2,e.selectedtab1="inactive",e.selectedtab2="active",e.selectedtab3="inactive"},e.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.updatestockarea=function(){var a={Id:e.stockareaId,latitude:e.latitude,longitude:e.longitude,phone:e.phone,code:e.code,address:e.address1};e.la===e.latitude&&e.lon===e.longitude&&e.ph===e.phone&&e.add1===e.address1||t.updatestockarea(a).then(function(t){"200"==t.data.code?(e.view=!0,o.success("Stockarea Updated successfully")):o.error(t.data.message)},function(e){o.error("Stockarea Not Added")})};var p=[{featureType:"administrative.country",elementType:"geometry.fill",stylers:[{color:"#f5f5f5"}]},{elementType:"geometry.fill",stylers:[{color:"#e6e6e6"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#cfcfcf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"administrative.province",elementType:"geometry.fill",stylers:[{color:"#e6e6e6"},{weight:1.5}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#cccccc"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off",color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off",color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b7e1ef"},{weight:2.5}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#b3b3b3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}];e.viewstockarea=function(){e.view=!0,e.newsa=!1,e.stockareaId=localStorage.getItem("selectedStockareaId");e.stockareaId;e.readname=!0,e.htmlTextToolTip=l.trustAsHtml('<div class="packageNameTooltip">You cannot change stockarea name.</div>');new google.maps.StyledMapType(p,{name:"Styled Map"}),new google.maps.Geocoder({region:"IN"});t.stockareaInfo(e.stockareaId).then(function(t){r.loading=!1,e.stockareaemails=t.data.data[0].emails,e.stockareamobiles=t.data.data[0].mobiles,e.stockareamobile=t.data.data[0].phone,e.stockareamobilep=t.data.data[0].phone,e.stockareaemail=t.data.data[0].primaryemail,e.stockareaemailp=t.data.data[0].primaryemail,e.stockareaId=t.data.data[0]._id,e.stockareaName=t.data.data[0].stockareaName,e.latitude=t.data.data[0].latitude,e.la=t.data.data[0].latitude,e.longitude=t.data.data[0].longitude,e.lon=t.data.data[0].longitude,e.address1=t.data.data[0].address,e.add1=t.data.data[0].address,e.phone=parseInt(t.data.data[0].phone),e.ph=parseInt(t.data.data[0].phone),e.lati=parseFloat(e.latitude),e.lngi=parseFloat(e.longitude);var a=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(e.lati,e.lngi),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});google.maps.event.trigger(a,"resize");var o={lat:e.lati,lng:e.lngi},n=new google.maps.Marker({position:o,draggable:!1,optimized:!1,map:a});[].push(n)})},e.editStockarea=function(a){e.view=!1,e.newsa=!1,e.stockareaId=a,e.readname=!0,e.htmlTextToolTip=l.trustAsHtml('<div class="packageNameTooltip">You cannot change stockarea name.</div>');new google.maps.StyledMapType(p,{name:"Styled Map"}),new google.maps.Geocoder({region:"IN"});t.stockareaInfo(a).then(function(t){r.loading=!1,e.stockareaemails=t.data.data[0].emails,e.stockareamobiles=t.data.data[0].mobiles,e.stockareamobile=t.data.data[0].phone,e.stockareamobilep=t.data.data[0].phone,e.stockareaemail=t.data.data[0].primaryemail,e.stockareaemailp=t.data.data[0].primaryemail,e.stockareaId=t.data.data[0]._id,e.stockareaName=t.data.data[0].stockareaName,e.latitude=t.data.data[0].latitude,e.la=t.data.data[0].latitude,e.longitude=t.data.data[0].longitude,e.lon=t.data.data[0].longitude,e.address1=t.data.data[0].address,e.add1=t.data.data[0].address,e.phone=parseInt(t.data.data[0].phone),e.ph=parseInt(t.data.data[0].phone),e.lati=parseFloat(e.latitude),e.lngi=parseFloat(e.longitude);var a=[],o=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(e.lati,e.lngi),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});google.maps.event.trigger(o,"resize");var n={lat:e.lati,lng:e.lngi},i=new google.maps.Marker({position:n,draggable:!0,optimized:!1,map:o});a.push(i),google.maps.event.addListener(i,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(i,"click",function(t){displayPosition(e,this.getPosition())});var c=document.getElementById("searchmap"),s=new google.maps.places.SearchBox(c);google.maps.event.addListener(s,"places_changed",function(){var t=s.getPlaces();if(0!=t.length){for(var n,r=0;n=a[r];r++)n.setMap(null);a=[];var i,c=new google.maps.LatLngBounds;for(r=0;i=t[r];r++){i.icon,new google.maps.Size(71,71),new google.maps.Point(0,0),new google.maps.Point(17,34),new google.maps.Size(25,25);o.setOptions({minZoom:1,maxZoom:16}),n=new google.maps.Marker({draggable:!0,map:o,title:i.name,optimized:!1,position:i.geometry.location}),displayPosition(e,i.geometry.location),google.maps.event.addListener(n,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(n,"click",function(t){displayPosition(e,this.getPosition())}),a.push(n),c.extend(i.geometry.location)}o.fitBounds(c)}}),google.maps.event.addListener(o,"bounds_changed",function(){var e=o.getBounds();s.setBounds(e)})})},e.submitotp=function(){null==e.motp||d.submitotp(e.motp).then(function(t){"200"==t.data.code?(e.otp=!1,e.otp1=!1,e.viewstockarea(),o.success("Mobile Number Verified Successfully")):o.error(t.data.message)},function(e){o.error(e)})},e.addprimarymobile=function(){null!==e.mobilep&&e.mobilep!==e.mobile&&d.addprimarymobile(e.mobilep).then(function(t){200==t.data.code?(e.viewstockarea(),o.success(e.mobilep+"is made as your primary mobilenumber")):413==t.data.code?o.error(e.mobilep+" is not verified"):o.error(e.mobilep+"as primary update Failed")},function(e){o.error(" mobile number update Failed")})},e.addprimarystockarea=function(){null!=e.stockareaemailp&&void 0!=e.stockareaemailp&&e.stockareaemailp?d.addprimarystockarea(e.stockareaemailp,e.stockareaId).then(function(t){200==t.data.code?(e.viewstockarea(),o.success(e.stockareaemailp+" is made as your primary email")):413==t.data.code?o.error(e.stockareaemailp+" is not verified"):o.error(e.stockareaemailp+" as primary update Failed")},function(t){o.error(e.stockareaemailp+" as primary update Failed")}):o.error("please select email")},e.addprimarymobilestockarea=function(){null!=e.stockareamobilep&&void 0!=e.stockareamobilep&&e.stockareamobilep?d.addprimarymobilestockarea(e.stockareamobilep,e.stockareaId).then(function(t){200==t.data.code?(e.viewstockarea(),o.success(e.stockareamobilep+"is made as your primary mobilenumber")):413==t.data.code?o.error(e.stockareamobilep+" is not verified"):o.error(e.stockareamobilep+"as primary update Failed")},function(e){o.error(" mobile number update Failed")}):o.error("please select mobile number")},e.id1=!1,e.deleteemail=function(t){void 0!==t&&null!==t&&d.deleteemail(t).then(function(a){e.viewstockarea(),o.success(t+" deleted successfully")},function(e){o.error(t+"delete Failed")})},e.deletemobile=function(t){void 0!==t&&null!==t&&d.deletemobile(t).then(function(a){e.viewstockarea(),o.success(t+"deleted successfully")},function(e){o.error(t+"delete Failed")})},e.deleteemailstockarea=function(t){void 0!==t&&null!==t&&d.deleteemailstockarea(t,e.stockareaId).then(function(a){e.viewstockarea(),o.success(t+" deleted successfully")},function(e){o.error(t+"delete Failed")})},e.deletemobilestockarea=function(t){void 0!==t&&null!==t&&d.deletemobilestockarea(t,e.stockareaId).then(function(a){e.viewstockarea(),o.success(t+"deleted successfully")},function(e){o.error(t+"delete Failed")})},e.addnewmailstockarea=function(){null!=e.stockareaemailnew&&void 0!=e.stockareaemailnew&&e.stockareaemailnew&&e.validateEmail(e.stockareaemailnew)?d.addnewmailstockarea(e.stockareaemailnew,e.stockareaId).then(function(t){e.viewstockarea(),"200"!=t.data.code?o.error("email id already associated with another account"):(o.success("Email added successfully"),e.stockareaemailnew=null)},function(e){o.error("Error adding emailId")}):o.error("Enter a valid email id")},e.addnewmobilestockarea=function(){null==e.stockareamobilenew&&"+91"==e.stockareamobilenew||d.addnewmobilestockarea(e.stockareamobilenew,e.code,e.stockareaId).then(function(t){"200"!=t.data.code?o.error("Mobile number already associated with another account"):(o.success("Mobilenumber added successfully"),e.stockareamobilenew=null,e.viewstockarea())},function(e){o.error("Error adding Mobilenumber")})},e.verify=function(t){d.verify(t).then(function(t){o.success("Mail sent successfully"),e.viewstockarea()},function(e){o.error("Mail Not sent !Error")})},e.otp=!1,e.verifymobile=function(t){e.hours=0,e.minutes=60,d.verifymobile(t).then(function(t){200==t.data.code?(e.otp=!0,o.success("Otp sent successfully"),e.countdown()):o.error("Otp Not sent !Error")},function(e){o.error("Otp Not sent !Error")})},e.otp1=!1,e.verifymobile1=function(t){e.hours1=0,e.minutes1=60,d.verifymobile(t).then(function(t){o.success("Otp sent successfully");n.open({templateUrl:"views/dashboard/otp.html",controller:"otpctrl",backdrop:"static",size:"sm",resolve:{minute:function(){return 60},hour:function(){return 0},stockareaId:function(){return e.stockareaId}}}).result.then(function(e){},function(t){"cancel"==t||e.viewstockarea(e.stockareaId)})})},e.report=function(t,a){e.id=t;n.open({templateUrl:"views/dashboard/report.html",controller:"reportctrl",backdrop:"static",size:"md",resolve:{productid:function(){return e.id},name:function(){return a}}}).result.then(function(e){},function(e){})},e.addpackage=function(t){n.open({templateUrl:"views/dashboard/addpackage.html",controller:"packagectrl",backdrop:"static",size:"md",resolve:{productid:function(){return t}}}).result.then(function(a){e.getSearchProducts(t,null)},function(a){"cancel"==a||e.getSearchProducts(t,null)})},e.suggestpackage=function(e){n.open({templateUrl:"views/dashboard/addpackage.html",controller:"suggestpackagectrl",backdrop:"static",size:"md",resolve:{productid:function(){return e}}}).result.then(function(e){},function(e){})},e.latc=function(){null==e.latitude?e.lat="This feild is required":e.lat=null},e.lonc=function(){null==e.longitude?e.lon="This feild is required":e.lon=null},e.addc=function(){null==e.address1&&(e.add="This feild is required")},e.namec=function(){null==e.stockareaName&&(e.na="stockarea name is required")},e.phc=function(){null==e.phone&&(e.ph1="Phone number is required")},e.phonechange=function(){null==e.phone?(e.ph="Phone number is required",e.phonestate=null):(e.ph=null,t.phonechange(e.phone).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.phonestate="exist":e.phonestate="Not exist!"}))},e.sellbutton=function(){return"1000"!=r.type&&r.productowner!=r.userId?(e.sellmsg="you don't have access to sell this product","inactiveproduct"):"1005"==r.stockareatype?(e.sellmsg="your can't sell a product from 'only-me' stockarea","inactivestockarea"):(e.sellmsg="sell this product","active")},e.init=function(){e.subtab=1,e.selectedtab1="active",e.subtab1=1,e.selectedtab11="active",r.editSelectedStockarea=!1,null==localStorage.getItem("access_token")||void 0==localStorage.getItem("access_token")?s.go("login"):t.isAuthenticated().then(function(n){t.category().then(function(t){e.category=t.data}),t.types().then(function(t){e.types=t.data}),t.stockareatypes().then(function(t){e.stockareatypes=t.data}),t.codes().then(function(t){e.codes=t.data.data.code,e.code="+91"}),t.getUserDetails().then(function(n){t.getStockArea(r.orgId).then(function(t){if(e.stockarea=t.data.data,t.data.data.length>0)if(r.userstatus="success",null==localStorage.getItem("selectedStockareaId")||void 0==localStorage.getItem("selectedStockareaId")){e.selectClassStockarea(t.data.data[0].stockareaId),e.getStockAreaProductFn(t.data.data[0].stockareaId),localStorage.setItem("selectedStockareaId",t.data.data[0].stockareaId),localStorage.setItem("selectedStockareaName",t.data.data[0].stockareaName),r.StockareaName=t.data.data[0].stockareaName,e.stockareaName=t.data.data[0].stockareaName,r.stockareaId=t.data.data[0].stockareaId,r.stockareatype=t.data.data[0].visiblity;for(var a=0;a<e.stockareatypes.length;a++)r.stockareatype==e.stockareatypes[a]._id&&(e.selectedproductvisiblityvalue=e.stockareatypes[a].desc,e.selectedproductvisiblity=e.stockareatypes[a]._id)}else e.selectClassStockarea(localStorage.getItem("selectedStockareaId")),e.getStockAreaProductFn(localStorage.getItem("selectedStockareaId")),e.stockareaName=localStorage.getItem("selectedStockareaName");else r.userstatus="pending",r.loading=!1,r.stockareaopen&&0!=r.stockareaopen||e.addStockarea1();e.getorganisation()},function(e){o.error("Stockarea Not Available"),a.info("Invalid UserName/Password")})})},function(e){s.go("login")})},e.getorganisation=function(){t.getorganisation(r.orgId).then(function(t){r.organisationinfo=t.data.data;var a=t.data.data.collabrators;e.collabrators=[];for(var o=0;o<a.length;o++)e.collabrators.push(a[o].organisationId)},function(e){o.error("organisation error")})},e.collabrator=function(e){t.collabrator(e).then(function(e){t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators})},function(e){o.error("cannot able to process u r request at this moment")})},e.ignore=function(e){t.ignore(e).then(function(e){t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators})},function(e){o.error("cannot able to process u r request at this moment")})},e.deletecollabrator=function(e){t.deletecollabrator(e,r.productId).then(function(e){t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators})},function(e){o.error("organisation error")})},e.autoExpand=function(e){var t="object"==typeof e?e.target:document.getElementById(e),a=t.scrollHeight-60;t.style.height=a+"px"};e.addlike=function(a,n){t.addlike(e.materialinfo._id,n).then(function(t){e.getbrandmaterialinfo(e.materialinfo._id,n)},function(e){o.error("brandmaterial error")})},e.removelike=function(a,n){t.removelike(e.materialinfo._id,n).then(function(t){e.getbrandmaterialinfo(e.materialinfo._id,n)},function(e){o.error("brandmaterial error")})},e.addStockarea1=function(t){var a=n.open({templateUrl:domainURL+"views/dashboard/addStockarea.html",controller:"addStockareaCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{stockareaid:function(){return"13213223"},scope:function(){return e},productid:function(){return"234234234"}}});r.stockareaopen=!0,a.result.then(function(t,a){o.success("Stockarea created successfully"),r.stockareaopen=!1,e.init()},function(e){r.stockareaopen=!1})},e.createorg=function(){s.go("createorg")},e.addcollabrator=function(){n.open({templateUrl:domainURL+"views/dashboard/addcollabrator.html",controller:"addcollabratorctrl",size:"md",backdrop:"static",resolve:{stockareaid:function(){return"13213223"},scope:function(){return e},productid:function(){return"234234234"}}}).result.then(function(e){t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators})},function(e){})},e.addStockarea=function(t){n.open({templateUrl:domainURL+"views/dashboard/addStockarea.html",controller:"addStockareaCtrl",backdrop:"static",size:"lg",resolve:{stockareaid:function(){return"13213223"},scope:function(){return e},productid:function(){return"234234234"}}}).result.then(function(t){o.success("Stockarea created successfully"),e.init()},function(e){})},e.myInterval=3e3,e.loadHome=function(){setheightandwidthofmaincontainer()};var f;e.RequestSellAccess=function(e){},e.setMapInfo=function(a){t.getProductStockInfo(r.productId,r.stockareaId).then(function(t){if(r.collabratorsinfo=t.data.data.collabrators,r.center&&null!=r.center&&void 0!=r.center)new google.maps.LatLng(r.center.lat,r.center.lng),o=r.center.lat,n=r.center.lng;else{new google.maps.LatLng(a.source.latitude,a.source.longitude);var o=a.source.latitude,n=a.source.longitude}var i;i=e.zoom?e.zoom:3,f=new google.maps.Map(document.getElementById("map"),{zoom:i,fullscreenControl:!1,center:{lat:o,lng:n},mapTypeId:"roadmap",mapTypeControl:!1,zoomControl:!0,scaleControl:!0,streetViewControl:!1,styles:p});new RichMarker({position:new google.maps.LatLng(a.source.latitude,a.source.longitude),content:'<div><div class="pulse"></div><div class="dot"></div></div>',map:f});var c,s=[],l=[],d=[],u=[];if(f.addListener("dragend",function(){var t=f.getBounds().toJSON();r.center=f.getCenter().toJSON(),e.zoom=f.getZoom(),console.log(t),e.mapinfochange(r.productId,localStorage.getItem("selectedStockareaId"),t)}),f.addListener("zoom_changed",function(){var t=f.getBounds().toJSON();r.center=f.getCenter().toJSON(),e.zoom=f.getZoom(),e.mapinfochange(r.productId,localStorage.getItem("selectedStockareaId"),t)}),void 0!=a.destinations)if(a.destinations.length>0)if(null!=a.destinations[0]){e.trade=!0;for(var m=0;m<a.destinations.length;m++)l[m]=[{lat:a.source.latitude,lng:a.source.longitude},{lat:a.destinations[m].latitude,lng:a.destinations[m].longitude}],s[m]=a.destinations[m].tradeinfo,d[m]=a.destinations[m].stockareaId,r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId._id==a.destinations[m]._id&&"active"==e.status.type}).length>0?null!==r.source&&void 0!==r.source&&a.destinations[m]._id==r.source.source?e.color="orange":e.color="#4c81bf":null!==a.destinations[m].visiblity&&void 0!==a.destinations[m].visiblity?1003==a.destinations[m].visiblity?e.color="darkgreen":e.color="orange":e.color="darkgreen",u[m]=new google.maps.Marker({position:{lat:a.destinations[m].latitude,lng:a.destinations[m].longitude},icon:{path:google.maps.SymbolPath.CIRCLE,scale:2,fillColor:e.color,strokeColor:e.color,fillOpacity:1,strokeWeight:2},zIndex:1,map:f,posInfo:[{lat:a.source.latitude,lng:a.source.longitude},{lat:a.destinations[m].latitude,lng:a.destinations[m].longitude}],tradeinfo:s[m]}),u[m].addListener("click",function(){c.setMap(null),g="#42f44e",(c=new google.maps.Polyline({path:this.posInfo,strokeColor:g,strokeOpacity:.6,strokeWeight:2,id:d[a],no:a,tradeinfo:this.tradeinfo})).setMap(f),google.maps.event.addDomListener(window,"load"),e.trade=!0,document.getElementById("tradeinfoDistance").innerHTML="Distance  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   :"+Math.round(this.tradeinfo.Distance)+"   KM",document.getElementById("tradeinfoPhoneNo").innerHTML="Phone Number :"+this.tradeinfo.code+" "+Math.round(this.tradeinfo.Phone),document.getElementById("tradeinfoStockareaName").innerHTML=this.tradeinfo.stockareaName;var t=domainURL+"productProfile/"+this.tradeinfo.stockareaName+"/"+this.tradeinfo.productName;if(!1!==this.tradeinfo.viewmore){var a=this.tradeinfo.stockareaName;if(r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==a&&"active"!==e.status[e.status.length-1].type}).length>0){var o=this.tradeinfo.stockareaId,n=this.tradeinfo.organisationId;document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#4c81bf; " title="pending" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+t+'">View Profile</a>'}else if(r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==a&&"active"==e.status[e.status.length-1].type}).length>0)document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#72bb53; " title="connected" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+t+'">View Profile</a>';else{o=this.tradeinfo.stockareaId,n=this.tradeinfo.organisationId;document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" title="connect" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" class="fa fa-link"onClick=angular.element(this).scope().addcollabratorinfo(\''+o+"','"+n+'\') style=" float:left " aria-hidden="true"></i><a class="viewprofile" href="'+t+'">View Profile</a>'}}else{a=this.tradeinfo.stockareaName;if(r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==a&&"active"!==e.status[e.status.length-1].type}).length>0){o=this.tradeinfo.stockareaId,n=this.tradeinfo.organisationId;document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#4c81bf; " title="pending" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i>'}else if(r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==a&&"active"==e.status[e.status.length-1].type}).length>0)document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#72bb53; " title="connected" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+t+'">View Profile</a>';else{o=this.tradeinfo.stockareaId,n=this.tradeinfo.organisationId;document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link" title="connect" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" onClick=angular.element(this).scope().addcollabratorinfo(\''+o+"','"+n+'\') style=" float:left " aria-hidden="true"></i>'}}e.tradedistance=this.tradeinfo.Distance});for(var g,h=l,y=0;y<h.length;y++){0==y&&(g="#42f44e",e.tradeCost=s[y].Cost,e.tradeSourceId=d[y],(c=new google.maps.Polyline({path:h[y],strokeColor:g,strokeOpacity:.6,strokeWeight:2,id:d[y],no:y,tradeinfo:s[y]})).setMap(f)),e.trade=!0,document.getElementById("tradeinfoDistance").innerHTML="Distance     &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp:"+Math.round(s[0].Distance)+"   KM",document.getElementById("tradeinfoPhoneNo").innerHTML="Phone Number :"+s[0].code+" "+Math.round(s[0].Phone),document.getElementById("tradeinfoStockareaName").innerHTML=s[0].stockareaName;var k=domainURL+"productProfile/"+s[0].stockareaName+"/"+s[0].productName;!1!==s[0].viewmore?r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==s[0].stockareaName&&"active"!==e.status[e.status.length-1].type}).length>0?document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#4c81bf; " title="pending" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+k+'">View Profile</a>':r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==s[0].stockareaName&&"active"==e.status[e.status.length-1].type}).length>0?document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#72bb53; " title="connected" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+k+'">View Profile</a>':document.getElementById("tradeinfoViewProfile").innerHTML='<i  id="link"  class="fa fa-link"  title="connect" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" onClick=angular.element(this).scope().addcollabratorinfo(\''+s[0].stockareaId+"','"+s[0].organisationId+'\')   style="float:left"aria-hidden="true"></i><a class="viewprofile" href="'+k+'">View Profile</a>':r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==s[0].stockareaName&&"active"!==e.status[e.status.length-1].type}).length>0?document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#4c81bf; " title="pending" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i>':r.collabratorsinfo.filter(function(e){return e.productstockId.stockareaId.stockareaName==s[0].stockareaName&&"active"==e.status[e.status.length-1].type}).length>0?document.getElementById("tradeinfoViewProfile").innerHTML='<i id="link" class="fa fa-link"style=" float:left;color:#72bb53; " title="connected" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" aria-hidden="true"></i><a class="viewprofile" href="'+k+'">View Profile</a>':document.getElementById("tradeinfoViewProfile").innerHTML='<i  id="link"  class="fa fa-link" title="connect" data-placement=\'bottom\' onmouseenter="$(this).tooltip(\'show\')" onClick=angular.element(this).scope().addcollabratorinfo(\''+s[0].stockareaId+"','"+s[0].organisationId+'\')   style="float:left"aria-hidden="true"></i>',e.tradedistance=s[0].Distance}}else e.trade=!1;else e.trade=!1})},e.resetMapInfo=function(){e.setMapInfo(e.mapInfo),setTimeout(function(){e.setMapInfo(e.mapInfo)},100)},e.resetMap=function(t){document.getElementById("tradeinfoDistance").innerHTML=null,document.getElementById("tradeinfoPhoneNo").innerHTML=null,document.getElementById("tradeinfoStockareaName").innerHTML=null,document.getElementById("tradeinfoViewProfile").innerHTML="",e.tradedistance=null,f=new google.maps.Map(document.getElementById("map"),{zoom:3,center:{lat:t.latitude,lng:parseFloat(t.longitude)},mapTypeId:"roadmap",mapTypeControl:!1,zoomControl:!0,scaleControl:!0,streetViewControl:!1,styles:p})},e.ownautocomplete=function(){$("#autocompletesearch").autocomplete({source:function(e,t){i({url:domainURL+"api/secured/authorize/privateproduct/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,productId:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.getSearchProducts(a.item.productId,a.item.value)}})},e.onenterkeyautocomplete=function(t){13==t.which&&($("#autocompletesearch").autocomplete("close"),e.getSearchProducts(null,t.target.value))},$("#fileInput").change(function(){e.newup=!0}),e.uploadnewprofile=function(){e.newup=!0},e.uploadFile=function(t){if(t){var a=new FileReader;a.onload=function(t){e.$apply(function(e){e.myImage=t.target.result})}}e.newup=!0,a.readAsDataURL(t)},e.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},e.productimages=[],e.addcollabratorinfo=function(e,a){t.getProductStockInfo(r.productId,e).then(function(n){t.addcollabrator(r.orgId,a,e,r.productId,r.productstockId,n.data.data._id).then(function(e){"200"==e.data.code?o.success("collabrator request initiated"):o.error(e.data.message)},function(e){o.error("Error initiating collabrator request")})})},e.stockDetails=[],e.uploadimg=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show(),e.productimages.push({img:e.myCroppedImage}),e.newup=!1},e.changeproductvisiblity=function(t,a){e.selectedproductvisiblityvalue=a,e.selectedproductvisiblity=t,$("#visib").removeClass("open")},e.govg=function(){1==e.leftab?s.reload("home.virtualgodown"):(e.leftab=1,s.go("home.virtualgodown"))},e.clickproduct=function(a){var o={categoryId:a};t.getSearchProductsInfo(o).then(function(t){if(null!=t.data.data){for(var a=t.data.data,o=e.products,n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");e.productsSearch=a,e.leftab=1,s.go("home.virtualgodown"),document.getElementById("searchresult").style.display="block"}else e.errorsearch="No products"})},e.updatenotification=function(){t.updatenotification().then(function(e){})},e.getSearchProducts=function(n,r){if(e.productsSearch=null,null==n)var i={term:r};else i={term:r,productId:n};t.getSearchProductsInfo(i).then(function(t){if(null!=t.data.data){for(var a=t.data.data,o=e.products,n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");e.productsSearch=a}else e.errorsearch="No products",console.log("No products")},function(e){o.error("Product Info Not Available"),a.info("Product Info Not Available")})},e.getSearchprivateProducts=function(n,r){document.getElementById("searchresult").style.display="block",t.getSearchprivateProductsInfo(n,r).then(function(t){if(null!=t.data.data){for(var a=t.data.data,o=e.products,n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");e.productsSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available"),a.info("Product Info Not Available")})},e.subtab113=function(){e.subtab1=3,document.getElementById("addproductdiv").style.display="block",document.getElementById("searchresult").style.display="none"},e.addproduct=function(){for(var t=0;t<e.productimages.length;t++)e.uploadproductimg(e.productimages[t].img,t)},e.sourceautocomplete=function(){$("#sourceautocompletesearch").autocomplete({source:function(e,t){$.ajax({dataType:"json",data:{term:e.term},type:"Get",contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:!1},crossDomain:!0,cache:!0,headers:{"Content-Type":"application/json"},url:domainURL+"api/secured/authorize/brand/autocomplete",success:function(a){var o=$.map(a.data,function(e){return{label:e.brandName,value:e.brandName}});t($.ui.autocomplete.filter(o,e.term))},error:function(e){}})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.sourcesubmit(a.item.value)}})},e.sourcesubmit=function(a){null!==a&&t.brand(a).then(function(t){e.sourcesearch=a,e.productbrand=t.data._id},function(e){})},e.deleteproductimage=function(t){var a=e.productimages.indexOf(t);e.productimages.splice(a,1)},e.leftab3=function(){t.getSearchProductsInfo({type:"private",term:" "}).then(function(t){if(null!=t.data.data){var a=t.data.data,o=e.products;if(null!=e.products&&void 0!=e.products&&e.products)for(var n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");else;e.productsSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available"),a.info("Product Info Not Available")}),e.leftab=3,r.sid=localStorage.getItem("selectedStockareaId"),s.go("home.myorg")},e.leftab4=function(){e.leftab=4,s.go("home.stockarea")},e.leftab2=function(){t.getprivateproducts().then(function(t){e.productsSearch=t.data.data,e.leftab=2,r.sid=null,r.uid=r.userId,s.go("home.ownedbyme")},function(e){o.error("Getting owned items error")})},e.leftab1=function(){r.sid=null,r.uid=null,e.productsSearch=[],e.leftab=1,s.go("home.virtualgodown")},e.pictures=[],e.uploadproductimg=function(a,n){var i=n;t.geturl(a).then(function(n){e.pictures.push(n.data.url);var c=e.productimages.length-1;if(e.urltoFile(a,n.data.name+".jpg","image/jpeg").then(function(e){var t=e;$.ajax({type:"PUT",data:t,url:n.data.signed_request,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})}),c==i){for(var s=[],l=0;l<e.pictures.length;l++)s.push({img:e.pictures[l]});t.addprivateproduct(e.productOwner,e.productname,e.productcategory,e.producttype,e.productdescription,e.productbrand,e.productmanufacturer,r.orgId,s).then(function(e){o.success("product added successfully")},function(e){o.error("error adding product")})}})},e.stockareasubtab1=function(){e.stockareasubtab=1},e.stockareasubtab4=function(){e.stockareasubtab=4},e.stockareasubtab2=function(){e.stockareasubtab=2},e.stockareasubtab3=function(){e.stockareasubtab=3},r.page=!0,r.editSelectedStockarea=!1,e.viewbuy=function(t,a){n.open({templateUrl:domainURL+"views/dashboard/materialview.html",controller:"AdminPagematerialviewctrl",size:"lg",resolve:{productId:function(){return t},tradeSourceId:function(){return a},destinationStockareName:function(){return e.stockareaName}}}).result.then(function(e){},function(){})},e.deleteproduct=function(a){e.selectedName=localStorage.getItem("selectedStockareaName"),a&&null!=a&&void 0!=a?t.deleteProduct(localStorage.getItem("selectedStockareaId"),a).then(function(e){o.success("Product removed from"+localStorage.getItem("selectedStockareaName"))},function(e){o.error("Product removing error")}):o.error("You have not added any products to your stockarea")},e.deletestockarea=function(a){localStorage.getItem("selectedStockareaName")==a.toUpperCase()?t.deleteStockarea(localStorage.getItem("selectedStockareaId")).then(function(t){o.success("Stockarea deleted successfully"),e.ds=!0,window.location.reload()},function(e){o.error("Error deleting stockarea")}):o.error("Entered text doesn't match with the stockarea name you wish to delete")},e.viewsell=function(t){n.open({templateUrl:domainURL+"views/dashboard/materialviewsell.html",controller:"materialViewSellCtrl",size:"lg",resolve:{productid:function(){return t}}}).result.then(function(t){e.stockDetails=t},function(t){"cancel"==t||"backdrop click"==t||(e.stockDetails=t)})},e.resetsearch=function(){e.search=null,e.productsSearch=null,e.getSearchProduct=null},e.viewInvoice=function(t){t.orderId.orderId;for(var a=0;a<e.orderInfo.length;a++)e.orderInfo[a].active=!1;t.active=!0,e.transactionInfo=t},e.dp=!1,e.ds=!1,e.addProductsToStockarea=function(a){var n=[];n.push(a),e.productInfo?e.productInfo.state="ADDED":(e.productInfo={},e.productInfo.state="ADDED");for(var r=0;r<e.productsSearch.length;r++)e.productsSearch[r]._id==a&&(e.productsSearch[r].state="ADDED");t.addProductsToStcokarea(localStorage.getItem("selectedStockareaId"),n).then(function(t){o.success("Product added to "+localStorage.getItem("selectedStockareaName")),e.getStockAreaProductFn(localStorage.getItem("selectedStockareaId"))},function(e){o.error("error")})},e.renameStockarea=function(){t.renameStockarea(e.renameStockareaValue,localStorage.getItem("selectedStockareaId")).then(function(t){for(var a=e.stockarea.length-1;a>=0;a--)e.stockarea[a].stockareaId==localStorage.getItem("selectedStockareaId")&&(e.stockarea[a].stockareaName=e.renameStockareaValue),e.stockareaName=e.renameStockareaValue})},e.selection=[],e.toggleSelection=function(t){var a=e.selection.indexOf(t);a>-1?e.selection.splice(a,1):e.selection.push(t)},r.loading=!0,e.viewProductFn=function(t){r.loading=!1,e.tab=5,s.go("home.virtualgodown",{productid:t})},e.selectProductFn=function(a,o){r.loading=!1;for(var n=0;n<e.products.length;n++)e.products[n].productId.productId==a?0==e.products[n].checked&&(e.getProductDetails(a,o),e.products[n].checked=!0,r.productId=e.products[n].productId._id,r.type=e.products[n].productId.type,r.selectedproductcategory=e.products[n].productId.categoryId._id,r.productowner=e.products[n].productId.createdBy,r.productName=e.products[n].productId.productName,r.productstockId=e.products[n]._id,r.source=e.products[n],t.getProductStockInfo(a,o).then(function(e){})):e.products[n].checked=!1},e.getStockAreaProductFn=function(n){r.loading=!0,t.getStockAreaProducts(localStorage.getItem("userId"),n).then(function(a){if(r.loading=!1,r.productsinstockarea=a.data.data.products,e.products=a.data.data.products,0==a.data.data.products.length&&(e.trade=!1,e.stockareaInfo={},e.productInfo={},e.orderInfo=[],e.productStockInfo={},r.productName=null,r.productId=null,r.type,r.selectedproductcategory=null,r.productowner=null,r.productstockId=null,e.resetMap(a.data.data),t.getstockareainfo(localStorage.getItem("selectedStockareaId")).then(function(t){e.setMapInfo(t.data.data)})),null!=a.data.data.products)for(var o=0;o<a.data.data.products.length;o++)null==r.productId||void 0==r.productId&&r.productstockId!==n?(r.productName=a.data.data.products[o].productId.productName,r.productId=a.data.data.products[o].productId._id,t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators,r.productstockId=e.data.data._id}),r.type=a.data.data.products[o].productId.type,r.selectedproductcategory=a.data.data.products[o].productId.categoryId._id,r.productowner=a.data.data.products[o].productId.createdBy,r.source=a.data.data.products[o],r.productstockId=n,e.getProductDetails(a.data.data.products[o].productId.productId,a.data.data.products[o].stockareaId),a.data.data.products[o].checked=!0):a.data.data.products[o].productId._id==r.productId?(e.getProductDetails(a.data.data.products[o].productId.productId,a.data.data.products[o].stockareaId),t.getProductStockInfo(r.productId,r.stockareaId).then(function(e){r.collabratorsinfo=e.data.data.collabrators,r.productstockId=e.data.data._id}),a.data.data.products[o].checked=!0):a.data.data.products[o].checked=!1,e.products=a.data.data.products},function(e){o.error("Stockarea Not Available"),a.info("Invalid UserName/Password")})},e.updatestockareavisiblity=function(){t.updatestockareavisiblity(e.selectedproductvisiblity).then(function(t){"200"==t.data.code?(r.stockareatype=e.selectedproductvisiblity,o.success("visiblity successfully updated")):o.success("visiblity update failed")})},e.mapinfochange=function(n,r,i){e.position=i&&null!=i&&void 0!=i?i:{south:-26.785178341287427,west:-19.26303710000002,north:43.03650486152034,east:175.50258789999998},t.mapInfo(n,r,e.position).then(function(t){if(null!=t.data.data){e.mapInfo=t.data.data,e.mapInfo.destinations.length;var a=new google.maps.OverlayView;a.draw=function(){this.getPanes().markerLayer.id="markerLayer"},a.setMap(f),e.setMapInfo(e.mapInfo),$("#markerLayer img").css("animation","pulse 1s infinite alternate"),$("#markerLayer img").css("-webkit-animation","pulse 1s infinite alternate")}},function(e){o.error("Map Info Not Available"),a.info("Map Info Not Available")})},e.getProductDetails=function(n,i,c){e.trade=!0,e.position=c&&null!=c&&void 0!=c?c:{south:-26.785178341287427,west:-19.26303710000002,north:43.03650486152034,east:175.50258789999998},t.mapInfo(n,i,e.position).then(function(t){if(null!=t.data.data){e.mapInfo=t.data.data,0==e.mapInfo.destinations.length&&(e.trade=!1);var a=new google.maps.OverlayView;a.draw=function(){this.getPanes().markerLayer.id="markerLayer"},a.setMap(f),e.setMapInfo(e.mapInfo),$("#markerLayer img").css("animation","pulse 1s infinite alternate"),$("#markerLayer img").css("-webkit-animation","pulse 1s infinite alternate")}},function(e){o.error("Map Info Not Available"),a.info("Map Info Not Available")}),e.setImageList=function(){e.setBtn()},e.imgScrollRightBntFn=function(){var t=$("#imageList").scrollLeft()+360,a=$("#imageList")[0].scrollWidth;a-t>0?a-t>60?$("#imageList").scrollLeft($("#imageList").scrollLeft()+60):$("#imageList").scrollLeft($("#imageList").scrollLeft()+a-t):$("#imgScrollRightBnt").hide(),e.setBtn()},e.imgScrollRightBntFn1=function(){var t=$("#imageList1").scrollLeft()+360,a=$("#imageList1")[0].scrollWidth;a-t>0&&(a-t>60?$("#imageList1").scrollLeft($("#imageList1").scrollLeft()+60):$("#imageList1").scrollLeft($("#imageList1").scrollLeft()+a-t)),e.setBtn1()},e.setBtn=function(){$("#imgScrollLeftBnt").hide(),$("#imgScrollRightBnt").hide();var e=$("#imageList").scrollLeft();if($("#imageList")[0]){var t=$("#imageList")[0].scrollWidth;e>0&&$("#imgScrollLeftBnt").show(),t>e+360&&$("#imgScrollRightBnt").show()}},e.setBtn1=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show();var e=$("#imageList1").scrollLeft(),t=$("#imageList1")[0].scrollWidth;e>0&&$("#imgScrollLeftBnt1").show(),t>e+360&&$("#imgScrollRightBnt1").show()},e.imgScrollLeftBntFn=function(){var t=$("#imageList").scrollLeft()+360,a=$("#imageList")[0].scrollWidth,o=a-t+360;o<a?a-o>60?$("#imageList").scrollLeft($("#imageList").scrollLeft()-60):$("#imageList").scrollLeft($("#imageList").scrollLeft()-(a-o)):$("#imgScrollLeftBnt").hide(),e.setBtn()},e.imgScrollLeftBntFn1=function(){var t=$("#imageList1").scrollLeft()+360,a=$("#imageList1")[0].scrollWidth,o=a-t+360;o<a&&(a-o>60?$("#imageList1").scrollLeft($("#imageList1").scrollLeft()-60):$("#imageList1").scrollLeft($("#imageList1").scrollLeft()-(a-o))),e.setBtn1()},e.setImgSrc=function(t){e.imgSrc=t},e.setImgSrc1=function(t){e.imgSrc1=t},t.productInfo(n,i).then(function(t){null!=t.data.data&&(r.productId=t.data.data._id,r.type=t.data.data.type,r.selectedproductcategory=t.data.data.categoryId._id,r.productowner=t.data.data.createdBy,r.ProductName=t.data.data.productName,e.productInfo=t.data.data,0!=e.productInfo.images.length&&(e.imgSrc=e.productInfo.images[0]),e.setBtn())},function(e){o.error("Product Info Not Available"),a.info("Product Info Not Available")}),e.loading1=!0,t.getProductStockInfo(n,i).then(function(t){e.loading1=!1,null!=t.data.data&&(e.productStockInfo=t.data.data,e.stockDetails=e.productStockInfo.stockDetails,console.log(e.stockDetails))},function(e){o.error("Product Stock Info Not Available"),a.info("Product Stock Info Not Available")}),t.stockareaInfo(n,i).then(function(e){null!=e.data.data&&(r.sorcestockid=i)},function(e){o.error("Stockarea Info Not Available"),a.info("Stockarea Info Not Available")})},e.getbrandmaterialinfo=function(a,n){t.getbrandmaterialinfo(a,n).then(function(t){e.materialinfo=t.data.data},function(e){o.error("brandmaterial error")})},e.productdescription=[{key:"",value:""}],e.addproductdescription=function(){e.productdescription.push({key:"",value:""})},e.removeproductdescription=function(){e.productdescription.pop()},e.approve=function(n){t.conform(n).then(function(n){o.sucess("order conformed"),t.orderInfo(productid,stockareaid).then(function(t){null!=t.data.data&&(e.orderInfo=t.data.data)},function(e){o.error("Order Info Not Available"),a.info("Order Info Not Available")})},function(e){o.error("Err")})},e.cancel=function(n){t.cancel(n).then(function(n){o.sucess("order cancelled successfully"),t.orderInfo(productid,stockareaid).then(function(t){null!=t.data.data&&(e.orderInfo=t.data.data)},function(e){o.error("Order Info Not Available"),a.info("Order Info Not Available")})},function(e){o.error("Err")})},e.deliveried=function(n){t.deliveried(n).then(function(n){o.Sucess("order cancelled successfully"),t.orderInfo(productid,stockareaid).then(function(t){null!=t.data.data&&(e.orderInfo=t.data.data)},function(e){o.error("Order Info Not Available"),a.info("Order Info Not Available")})},function(e){o.error("Err")})},e.selectStockarea=function(t,a,o){if(e.transactionInfo=null,r.productId=null,r.productstockId=null,e.products=null,r.stockareatype=null,r.type=null,r.selectedproductcategory=null,t!=localStorage.getItem("selectedStockareaId")){e.search=null,e.productsSearch,e.getSearchProduct=null,e.trade=!1,e.getStockAreaProductFn(t),e.selectClassStockarea(t),localStorage.setItem("selectedStockareaId",t),localStorage.setItem("selectedStockareaName",a),r.stockareatype=o;for(var n=0;n<e.stockareatypes.length;n++)r.stockareatype==e.stockareatypes[n]._id&&(e.selectedproductvisiblityvalue=e.stockareatypes[n].desc,e.selectedproductvisiblity=e.stockareatypes[n]._id);r.stockareaId=localStorage.getItem("selectedStockareaId"),e.stockareaName=a,r.StockareaName=a,e.tab=1}},e.notificationselectStockarea=function(a){e.transactionInfo=null,r.productstockId=null,a!=localStorage.getItem("selectedStockareaId")&&(e.search=null,e.productsSearch=null,e.getSearchProduct=null,e.trade=!1,e.getStockAreaProductFn(a),e.selectClassStockarea(a),localStorage.setItem("selectedStockareaId",a),t.getstockareainfo(a).then(function(t){r.stockareaId=localStorage.getItem("selectedStockareaId"),e.stockareaName=t.data.data.source.stockareaName,r.StockareaName=t.data.data.source.stockareaName,r.stockareatype=t.data.data.source.visiblity;for(var a=0;a<e.stockareatypes.length;a++)r.stockareatype==e.stockareatypes[a]._id&&(e.selectedproductvisiblityvalue=e.stockareatypes[a].desc,e.selectedproductvisiblity=e.stockareatypes[a]._id);e.tab=3}))},e.selectClassStockarea=function(t){for(var a=0;a<e.stockarea.length;a++)e.stockarea[a].stockareaId==t?e.stockarea[a].selected=!0:e.stockarea[a].selected=!1},r.addAStockarea=function(t){e.stockarea[e.stockarea.length]=t,e.selectStockarea(e.stockarea[e.stockarea.length-1].stockareaId,e.stockarea[e.stockarea.length-1].stockareaName,e.stockarea[e.stockarea.length-1].visiblity)};e.graphPlots=[{x:[1,2,3,4],y:[10,15,13,17],type:"scatter"},{x:[1,2,3,4],y:[16,5,11,9],type:"scatter"},{x:[1,2,3,4],y:[23,4,2,6],type:"scatter"},{x:[1,2,3,4],y:[9,11,3,12],type:"scatter"}]}]),vgApp.controller("faqcontroller",["$scope","dashboardService","$timeout","Notification",function(e,t,a,o){}]),vgApp.controller("ownedbymeController",["$scope","dashboardService","$timeout","Notification",function(e,t,a,o){}]),vgApp.controller("virtualgodownhomeController",["$scope","dashboardService","$timeout","Notification",function(e,t,a,o){}]),vgApp.directive("myPostRepeatDirective",function(){return function(e,t,a){if(e.$last){setInterval(e.setBtn(),1e3),$("#imgScrollLeftBnt").hide(),$("#imgScrollRightBnt").hide();var o=$("#imageList").scrollLeft(),n=128*e.$parent.productInfo.images.length;o>0&&$("#imgScrollLeftBnt").show(),n>o+360&&$("#imgScrollRightBnt").show()}}}),vgApp.directive("myPostRepeatDirectiv",function(){return function(e,t,a){if(e.$last){setInterval(e.setBtn1(),1e3),$("#imgScrollLeftBnt1").show(),$("#imgScrollRightBnt1").show();var o=$("#imageList1").scrollLeft(),n=128*e.productimages.length;o>0&&$("#imgScrollLeftBnt1").show(),n>o+360&&$("#imgScrollRightBnt1").show()}}}),vgApp.controller("dashboardHeaderController",["$state","$scope","dashboardService","loginService","$uibModal","$rootScope","$timeout","$http",function(e,t,a,o,n,r,i,c){!0!==r.er&&(null==localStorage.getItem("access_token")||void 0==localStorage.getItem("access_token")?(t.access=!1,t.loading=!1):(t.access=!0,t.loading=!1,o.getUserDetails().then(function(e){r.isAdmin=!0,r.org=e.data.data.org,null!=r.orgId&&void 0!=r.orgId&&r.org||(r.orgId=e.data.data.org[0].organisationId._id,r.orgname=r.org[0].organisationId.organisationId,r.orgstatus=r.org[0].organisationId.status),"pendingstock"==e.data.data.status&&(r.userstatus="pending"),t.value=0,r.newmessages=0;var a=angular.element(document.querySelector(".notification")),o=function(){i(function(){localStorage.getItem("userId")&&localStorage.getItem("access_token")&&c({url:domainURL+"api/secured/authorize/notification/getinfo",method:"GET",ignoreLoadingBar:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(e){r.notification=e.data.data.notification,r.allnotification=e.data.data.allnotification,r.messages=e.data.data.messages;for(var n=0;n<r.messages.length;n++)for(var i=0;i<r.messages[n].receiptent.length;i++)r.messages[n].receiptent[i].userId==r.userId&&201==r.messages[n].receiptent[i].status&&r.newmessages++;t.value!==r.notification.length&&(0==r.notification.length||(t.value=r.notification.length,a.toggleClass("notify"))),o()})},1e4)};o()},function(e){t.access=!1,t.loading=!1}))),t.faq=function(){e.go("faq")},t.settings=function(){e.go("settings")},t.gohome=function(){e.go("home")},t.poll=function(){if(localStorage.getItem("userId")&&localStorage.getItem("access_token")){t.value=0;var e=angular.element(document.querySelector(".notification")),a=function(){i(function(){c({url:domainURL+"api/secured/authorize/notification/getinfo",method:"GET",ignoreLoadingBar:!0,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(o){r.notification=o.data.data.notification,r.allnotification=o.data.data.allnotification,r.messages=o.data.data.messages,t.value!=r.notification.length&&(e.toggleClass("notify"),t.value=r.notification.length),a()})},1e4)};a()}},t.updatenotification=function(e,o,n,i){r.checktab(o,n),a.updatenotification().then(function(e){}),t.poll()},t.getInfo=function(){o.getUserDetails().then(function(e){r.fullName=e.data.data.fullName,r.profilePic=e.data.data.profilePic,r.userId=e.data.data._id,r.org=e.data.data.org,null!=r.orgId&&void 0!=r.orgId&&r.org||(r.orgId=e.data.data.org[0].organisationId._id,r.orgname=r.org[0].organisationId.organisationId,r.orgstatus=r.org[0].organisationId.status),"pendingstock"==e.data.data.status&&(r.userstatus="pending")},function(e){t.access=!1,t.loading=!1})},t.logout=function(){a.logout(localStorage.getItem("userId"),localStorage.getItem("access_token")).then(function(t){r.orgId=null,r.userId=null,localStorage.clear(),e.go("login")})},t.signup=function(){e.go("signUp")},t.login=function(){e.go("login")},t.messagetohelp=function(){r.helpmessage()},t.getOrgInfo=function(e){a.getorganisation(e).then(function(e){r.organisationinfo=e.data.data;for(var t=e.data.data.collabrators,a=0;a<t.length;a++)t[a].userId._id==r.userId&&("admin"==t[a].role?r.isAdmin=!0:r.isAdmin=!1)},function(e){Notification.error("organisation cannot be changed at this time")})},t.changeorg=function(o){for(var n=0;n<r.org.length;n++)r.org[n].organisationId._id==o?(r.orgname=r.org[n].organisationId.organisationId,r.orgstatus=r.org[0].organisationId.status,a.getorganisation(o).then(function(a){r.orgId=o,r.productName=null,r.productId=null,r.productstockId=null,r.editSelectedStockarea=null,localStorage.removeItem("selectedStockareaId"),localStorage.removeItem("selectedStockareaName"),r.organisationinfo=a.data.data;a.data.data.collabrators;r.isAdmin=!0,t.getInfo(),e.go("home.virtualgodown"),e.reload()},function(e){Notification.error("organisation cannot be changed at this time")})):console.log("err")},t.profile=function(){e.go("profile")},t.home=function(){window.location.replace("/")}}]),vgApp.directive("linePlot",[function(){return{link:function(e,t,a){e.$watch("graphPlots",function(e){Plotly.newPlot(t[0],e,{displayModeBar:!1})})}}}]);var country="IN",startDragPosition={lat:22.745154893908804,lng:78.25780350000002};function addresComponent(e,t,a){for(var o=0;o<t.address_components.length;o++)for(var n=0;n<t.address_components[o].types.length;n++)if(t.address_components[o].types[n]==e)return a?t.address_components[o].short_name:t.address_components[o].long_name;return""}vgApp.controller("editproductController",["$stateParams","$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$q",function(e,t,a,o,n,r,i,c,s){i.highlightcollabrator=null,t.testbrand=function(){return"true"!=t.brd||!(!t.brand||null==t.brand||void 0==t.brand)},t.testlinks=function(){return"true"!=t.link||t.referenceproducts.length==t.productmaterials.length},t.updateproduct=function(){if(null!=t.productname&&""!=t.productname&&null!=t.productcategory&&""!=t.productcategory&&t.testlinks()&&t.testbrand()){if(0==t.productimages.length)t.spec=t.productdescription,a.updateproduct(t.productId,t.productname,t.productcategory,t.producttype,t.productdescription,t.brand,t.pictures,t.spec,t.productmaterial).then(function(e){n.success("product updated successfully"),c.go("home.virtualgodown")},function(e){n.error("error updating product")});else for(var e=0;e<t.productimages.length;e++)t.productimages[e].img.indexOf("amazonaws")<-1?t.uploadproductimg(t.productimages[e].img,e):t.pictures.push({img:t.productimages[e].img});t.spec=t.productdescription,a.updateproduct(t.productId,t.productname,t.productcategory,t.producttype,t.productdescription,t.brand,t.pictures,t.spec,t.productmaterial).then(function(e){n.success("product updated successfully"),c.go("home.virtualgodown")},function(e){n.error("error updating product")})}else{var o;null!=t.productname&&""!=t.productname||(t.productname="",o="<div>Asset name is required.</div> "),null!=t.productcategory&&""!=t.productcategory||(t.productcategory="",o+="<div>Asset category is required.</div> "),t.testlinks()||(o+="<div>Asset you are trying to link is not in our system. please select the existing one or create a product for it.</div> "),t.testbrand()||(t.branderror="true",o+="<div>Brand you trying to link to your product is not in our system. please add brand in our system before including it.</div> "),n.error({message:o,positionY:"top",positionX:"center",delay:2e3,verticalSpacing:1500,horizontalSpacing:50})}},a.category().then(function(e){t.category=e.data}),t.brdtrue=function(){t.brd="true"},t.brd1=function(){t.brd="false"},t.addproductlink=function(){t.referenceproducts.push({product:""})},t.removeproductlink=function(e){t.referenceproducts.pop()},t.resize=function(e){e&&e.target&&void 0!=e.target&&(e.target.style.height=e.target.scrollHeight+"px")},t.cancel=function(){c.go("home.virtualgodown"),i.leftab=1},t.deleteproductimage=function(e){var a=t.productimages.indexOf(e);t.productimages.splice(a,1)},t.brandautocomplete=function(){$("#brandautocompletesearch").autocomplete({source:function(e,t){r({url:domainURL+"api/brand/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,Id:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){t.brand=a.item.Id,t.branderror="false"}})},t.categoryautocomplete=function(){$("#categoryautocomplete").autocomplete({source:function(e,a){a($.map(t.category,function(e){return{label:e.name,value:e.name,Id:e._id}}))},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){t.productcategory=a.item.Id}})},t.productautocomplete=function(){$("#productautocomplete").autocomplete({source:function(e,t){r({url:domainURL+"api/secured/authorize/products/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,Id:e._id,specifications:e.specifications}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(e,a){t.setmaterial(a.item.Id)}})},t.uploadproductimg=function(e,o){a.geturl(e).then(function(a){t.pictures.push({img:a.data.url});t.productimages.length;t.urltoFile(e,a.data.name+".jpg","image/jpeg").then(function(e){var t=e;$.ajax({type:"PUT",data:t,url:a.data.signed_request,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})})})},t.myCroppedImage="",t.myFile="",$("#fileInput").change(function(){t.newup=!0}),t.uploadnewprofile=function(){t.newup=!0},t.uploadFile=function(e){if(e){var a=new FileReader;a.onload=function(e){t.$apply(function(t){t.myImage=e.target.result})},t.newup=!0,a.readAsDataURL(e)}},t.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},t.productimages=[],t.uploadimg=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show(),t.productimages.push({img:t.myCroppedImage}),t.newup=!1},t.addproductdescription=function(){t.productdescription.push({key:"",value:""})},t.removeproductdescription=function(){t.productdescription.pop()},t.height=function(){var o,r=screen.height;(r=window.innerHeight)>640?(o=r-60-80-70-20,document.getElementById("addproduct").style.height=o-53+"px"):(o=430,document.getElementById("addproduct").style.height=o-53+"px"),t.productId=e.productId,t.referenceproducts=[],a.productInfo(e.productId).then(function(e){if(t.productOwner=i.org.organisationId,i.fullName,t.productname=e.data.data.productName,t.productcategory=e.data.data.categoryId._id,t.productcategry=e.data.data.categoryId.name,t.producttype=e.data.data.type,t.links=e.data.data.links,t.links&&0!=t.links.length){t.link="true";for(var a=0;a<t.links.length;a++)t.referenceproducts.push({product:t.links[a].productId.productName}),t.productmaterials.push({product:t.links[a].productId._id})}else t.link="false",t.referenceproducts.push({product:""});t.productdescription=e.data.data.completeInfo,e.data.data.brandId?(t.brdtrue(),t.brnd=e.data.data.brandId.productName,t.brand=e.data.data.brandId._id):t.brd1(),t.productimages=e.data.data.images,null!=t.productdescription&&void 0!=t.productdescription&&t.productdescription||(t.productdescription=[{key:"",value:""}])},function(e){n.error("Getting product error"),t.subtab1=2})}}]),vgApp.controller("editstockareactrl",["$scope","$uibModalInstance","stockareaId","stockareaName","$state","dashboardService","$timeout","$uibModal","$rootScope","$location",function(e,t,a,o,n,r,i,c,s,l){e.readname=!0;r.codes().then(function(t){e.codes=t.data.data.code,e.code="+91"}),r.stockareaInfo(a).then(function(t){e.stockareaName=t.data.data[0].stockareaName,e.latitude=t.data.data[0].latitude,e.longitude=t.data.data[0].longitude,e.phone=parseInt(t.data.data[0].phone),e.lat=parseInt(t.data.data[0].latitude),e.lng=parseInt(t.data.data[0].longitude)});var d=new google.maps.StyledMapType([{featureType:"administrative.country",elementType:"geometry.fill",stylers:[{color:"#f5f5f5"}]},{elementType:"geometry.fill",stylers:[{color:"#e6e6e6"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#cfcfcf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"administrative.province",elementType:"geometry.fill",stylers:[{color:"#e6e6e6"},{weight:1.5}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#cccccc"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off",color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off",color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b7e1ef"},{weight:2.5}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#b3b3b3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}],{name:"Styled Map"});new google.maps.Geocoder({region:"IN"});t.rendered.then(function(){r.stockareaInfo(a).then(function(t){e.stockareaName=t.data.data[0].stockareaName,e.latitude=t.data.data[0].latitude,e.longitude=t.data.data[0].longitude,e.phone=parseInt(t.data.data[0].phone),e.lati=parseInt(e.latitude),e.lngi=parseInt(e.longitude);var a=[],o=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(e.lati,e.lngi),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});o.mapTypes.set("styled_map",d),o.setMapTypeId("styled_map"),google.maps.event.trigger(o,"resize");var n={lat:e.lat,lng:e.lng},r=new google.maps.Marker({position:n,draggable:!0,optimized:!1,map:o});a.push(r),google.maps.event.addListener(r,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(r,"click",function(t){displayPosition(e,this.getPosition())});var i=document.getElementById("searchmap");o.controls[google.maps.ControlPosition.TOP_LEFT].push(i);var c=new google.maps.places.SearchBox(i);google.maps.event.addListener(c,"places_changed",function(){var t=c.getPlaces();if(0!=t.length){for(var n,r=0;n=a[r];r++)n.setMap(null);a=[];var i,s=new google.maps.LatLngBounds;for(r=0;i=t[r];r++){i.icon,new google.maps.Size(71,71),new google.maps.Point(0,0),new google.maps.Point(17,34),new google.maps.Size(25,25);n=new google.maps.Marker({draggable:!0,map:o,title:i.name,optimized:!1,position:i.geometry.location}),displayPosition(e,i.geometry.location),google.maps.event.addListener(n,"dragend",function(t){displayPosition(e,this.getPosition())}),google.maps.event.addListener(n,"click",function(t){displayPosition(e,this.getPosition())}),a.push(n),s.extend(i.geometry.location)}o.fitBounds(s)}}),google.maps.event.addListener(o,"bounds_changed",function(){var e=o.getBounds();c.setBounds(e)})})}),e.stockareaId=a,e.close=function(){"pending"!==s.userstatus&&t.dismiss("cancel")},e.latc=function(){null==e.latitude?e.lat="This feild is required":e.lat=null},e.lonc=function(){null==e.longitude?e.lon="This feild is required":e.lon=null},e.addc=function(){null==e.address&&(e.add="This feild is required")},e.namec=function(){null==e.stockareaName&&(e.na="stockarea name is required")},e.phc=function(){null==e.phone&&(e.ph="Phone number is required")},e.phonechange=function(){null==e.phone?(e.ph="Phone number is required",e.phonestate=null):(e.ph=null,r.phonechange(e.phone).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.phonestate="exist":e.phonestate="Not exist!"}))},e.fnAddStockarea=function(){var t={Id:a,latitude:e.latitude,longitude:e.longitude,phone:e.phone};r.updatestockarea(t).then(function(e){Notification.error("Stockarea Updated successfully")},function(e){Notification.error("Stockarea Not Added")})}}]),vgApp.config(["$stateProvider",function(e){e.state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"loginController"}).state("home",{url:"/",templateUrl:domainURL+"views/dashboard/home.html",controller:"homeController",authenticate:"true",redirectTo:"home.virtualgodown"}).state("home.virtualgodown",{url:"",controller:"vgController",templateUrl:domainURL+"views/dashboard/virtualgodown.html",params:{type:1,productid:null}}).state("home.myorg",{url:"",controller:"myorgController",templateUrl:domainURL+"views/dashboard/myassets.html"}).state("home.mybrands",{url:"",controller:"mybrandController",templateUrl:domainURL+"views/dashboard/mybrands.html"}).state("home.stockarea",{url:"",controller:"ownController",templateUrl:domainURL+"views/dashboard/stockarea.html"}).state("home.addproduct",{url:"",templateUrl:domainURL+"views/dashboard/new_addproductinfo.html",controller:"addproductinfoController"}).state("home.editproduct",{url:"",templateUrl:domainURL+"views/dashboard/editproduct.html",params:{productId:null},controller:"editproductController"}).state("home.editbrand",{url:"",templateUrl:domainURL+"views/dashboard/editbrand.html",params:{brandId:null},controller:"editbrandController"}).state("suggestproduct",{url:"/suggestproduct",templateUrl:domainURL+"views/dashboard/suggestproduct.html",controller:"suggestproductController",authenticate:"true"}).state("FAQ",{url:"/faq",templateUrl:domainURL+"views/dashboard/faq.html",controller:"faqcontroller"}).state("createorg",{url:"/createorganisation",templateUrl:domainURL+"views/dashboard/createorg.html",controller:"createorgctrl"}).state("forgotPassword",{url:"/forgotPassword",templateUrl:domainURL+"views/login/forgot-password.html",controller:"forgotPasswordController",params:{term:null},authenticate:"false"}).state("resetPassword",{url:"/resetPassword/:token",templateUrl:domainURL+"views/login/reset-password.html",controller:"resetPasswordController"}).state("onVerifyAction",{url:"onVerifyAction/{token}",controller:"onVerifyActionController",authenticate:"true"}).state("verifyemail",{url:"/verifyemail/{token}",templateUrl:domainURL+"views/login/verifyemail.html",controller:"verifyemailcontroller",authenticate:"false"}).state("collabrator",{url:"/collabrator/:token/:value",controller:"collabratorctrl"}).state("signUp",{url:"/signUp",templateUrl:domainURL+"views/login/signup.html",controller:"signupController",authenticate:"false"}).state("settings",{url:"/settings",templateUrl:domainURL+"views/dashboard/settings.html",controller:"settingsController",authenticate:"true"}).state("profile",{url:"/profile",templateUrl:domainURL+"views/dashboard/profile.html",controller:"profileController",authenticate:"true"}).state("productprofile",{url:"/productProfile/:stockareaName/:productName",templateUrl:domainURL+"views/dashboard/productprofile.html",controller:"ProductProfileCtrl",authenticate:"true"})}]),vgApp.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,a,o){var n=e(o.fileModel).assign;a.bind("change",function(){t.$apply(function(){n(t,a[0].files[0])})})}}}]),vgApp.controller("loginController",["$scope","$state","$log","loginService","Notification","localStorageService","$rootScope","$http","$stateParams",function(e,t,a,o,n,r,i,c,s){i.indexloader="false",e.forgotlogin=function(){t.go("forgotPassword",{term:e.email})},e.signup=function(){t.go("signUp")},i.highlightcollabrator=null;var l=localStorage.getItem("access_token"),d=localStorage.getItem("userId");e.init=function(){null!=i.info&&void 0!=i.info&&i.info?"changepassword"==i.info?i.smsg="We have successfully reseted your password please login to continue":"token"==i.info&&(i.info=null,e.errormessage="The link you are trying to access is expired.Try again"):i.smsg="null",localStorage.getItem("orgId")&&null!=localStorage.getItem("orgId")&&null!=localStorage.getItem("userId")&&void 0!=localStorage.getItem("orgId")&&void 0!=localStorage.getItem("userId")&&void 0!=localStorage.getItem("access_token")&&null!=localStorage.getItem("access_token")&&c({method:"POST",headers:{"Content-Type":"application/json"},data:{userId:d,access_token:l},url:domainURL+"api/token/checktoken"}).then(function(e){i.info=null,t.go("home.virtualgodown")},function(e,t,a){}),404==i.error?e.errormessage="Requested URL is not available":i.error>500&&(e.errormessage="Error occured in Server please try again after some time")},i.notify=function(){n.clearAll(),n.error({message:'<div style="display:inline-block;"><i style="color:white" class="fa fa-warning"></i> It seems you have a connectivity issue</div><font ng-click="closeAll()" style="float:right;margin-left:20px;display:inline-block">X</font>',positionY:"top",positionX:"center",delay:1e13,verticalSpacing:150,horizontalSpacing:50})},e.close=function(){i.errormessage=null},i.page=!1,e.fnAuthenticateUser=function(){o.authenticateUser(e.email.toLowerCase(),e.password).then(function(c){c.data.token&&(localStorage.setItem("access_token",c.data.token),localStorage.setItem("userId",c.data.userId)),o.getUserDetails().then(function(e){r.isSupported?c.data.token?(i.fullName=e.data.data.fullName,i.profilePic=e.data.data.profilePic,i.userId=e.data.data._id,i.org=e.data.data.org,localStorage.setItem("orgId",e.data.data.org[0].organisationId._id),i.orgId=e.data.data.org[0].organisationId._id,i.orgname=i.org[0].organisationId.organisationId,i.orgstatus=i.org[0].organisationId.status,a.info("User Authenticated Successfully"),t.go("home.virtualgodown")):n.error(c.data.message):n.error("Invalid Username/Password"),"pendingstock"==e.data.data.status&&(i.userstatus="pending")},function(t){e.access=!1,e.loading=!1})}).catch(function(e){n.error("Invalid Username/Password"),a.info("Invalid UserName/Password")})}}]),vgApp.controller("loginDashBoardController",["$scope","$state","$http","$location","$log","loginService","Notification","localStorageService","$rootScope",function(e,t,a,o,n,r,i,c,s){s.indexloader="false",s.highlightcollabrator=null;var l=localStorage.getItem("access_token"),d=localStorage.getItem("userId");l=localStorage.getItem("access_token"),d=localStorage.getItem("userId");null===l?"login"==t.current.name||"signUp"==t.current.name||"forgotPassword"==t.current.name||t.go("login"):a({method:"POST",headers:{"Content-Type":"application/json"},data:{userId:d,access_token:l},url:domainURL+"api/token/checktoken"}).then(function(e){"login"==t.current.name||"signUp"==t.current.name||t.current.name},function(e,t,a){localStorage.clear()})}]),vgApp.controller("settingsController",["$sce","$scope","$state","$log","loginService","Notification","localStorageService","$http","dashboardService","$rootScope","$timeout","$uibModal",function(e,t,a,o,n,r,i,c,s,l,d,u){l.indexloader="false";t.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},s.types().then(function(e){t.types=e.data}),l.notify=function(){r.clearAll(),r.error({message:'<div style="display:inline-block;margin-left:20px;"><i style="color:white" class="fa fa-warning"></i> Internet connection Error</div><font ng-click="closeAll()" style="float:right;display:inline-block">X</font>',positionY:"top",positionX:"center",delay:1e13,verticalSpacing:50,horizontalSpacing:20})},t.orgto="till-now",l.highlightcollabrator=null,t.submitotp=function(){null==t.motp||n.submitotp(t.motp).then(function(e){t.otp=!1,t.otp1=!1,t.init(),t.editStockarea(localStorage.getItem("selectedStockareaId")),r.success("Mobile Number Verified Successfully")},function(e){r.error(e)})},t.adrs=!0,t.secmails=[],t.init=function(){l.loading=!0,t.newsa=!1,n.getUserDetails().then(function(e){l.loading=!1,t.newup=!1,t.fullname=e.data.data.fullName,t.mobile=e.data.data.primaryMobile,t.mobilep=t.mobile,l.profilePic=e.data.data.profilePic,t.mobiles=e.data.data.mobile,t.email=e.data.data.userName,t.emailp=e.data.data.userName,t.emails=e.data.data.email,t.emailss=e.data.data.email,t.semail=e.data.data.secondaryEmail,null!=e.data.data.dob&&e.data.data.dob&&void 0!=e.data.data.dob&&(t.dob=e.data.data.dob.slice(0,10)),t.company=e.data.data.company,t.pincode=e.data.data.pincode,t.address=e.data.data.address,t.city=e.data.data.city,t.state=e.data.data.state,t.country=e.data.data.country,t.organisation=e.data.data.organisation,t.url=e.data.data.profilePic,t.myFile=null;for(var a=0;a<t.emailss.length;a++)t.emailss[a].email!==t.email&&t.secmails.push({email:t.emailss[a].email});t.f=t.fullname,t.d=t.dob,t.a=t.address,s.getallstockareas(l.orgId).then(function(e){t.stockareas=e.data.data,1==l.editSelectedStockarea&&(t.tab=5,t.subtab=1,t.viewstockarea(localStorage.getItem("selectedStockareaId")))})})};var p=[{featureType:"administrative.country",elementType:"geometry.fill",stylers:[{color:"#f5f5f5"}]},{elementType:"geometry.fill",stylers:[{color:"#e6e6e6"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f5f5"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#cfcfcf"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#bdbdbd"}]},{featureType:"administrative.province",elementType:"geometry.fill",stylers:[{color:"#e6e6e6"},{weight:1.5}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#cccccc"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.stroke",stylers:[{color:"#ffffff"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#f2f5f5"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"off",color:"#eeeeee"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off",color:"#757575"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#757575"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#dadada"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#616161"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#e5e5e5"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#c9c9c9"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b7e1ef"},{weight:2.5}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#b3b3b3"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#9e9e9e"}]}];s.codes().then(function(e){t.codes=e.data.data.code,t.code="+91"}),t.ud=!1,t.userd=function(){t.ud=!0},t.tab5=function(){t.tab=5,t.subtab=1,t.viewstockarea(t.stockareas[0]._id)},t.updateprofile=function(){var e={fullName:t.fullname,dob:t.dob,address:t.address};t.f==t.fullname&&t.d==t.dob&&t.a==t.address||n.updateprofile(e).then(function(e){r.success("Personal information updated successfully."),t.init()},function(e){r.error("Error updating personal information")})},t.updatepassword=function(){t.p=t.oldpassword,t.n=t.newpassword,n.updatepassword(t.oldpassword,t.newpassword).then(function(e){t.init(),r.success("Password updated successfully"),t.oldpassword=null,t.newpassword=null},function(e){r.error("Error updating password")})},t.myFile=null,t.myCroppedImage="",t.myImage="",t.uploadFile=function(e){if(e){var a=new FileReader;a.onload=function(e){t.$apply(function(t){t.myImage=e.target.result})},a.readAsDataURL(e)}},t.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},t.progress=!0,t.uploadimg=function(){n.geturl(t.img).then(function(e){t.urltoFile(t.myCroppedImage,e.data.name+".jpg","image/jpeg").then(function(o){var i=o,c=e.data.signed_request,s=e.data.url;t.progress=!1,$.ajax({type:"PUT",data:i,url:c,processData:!1,contentType:!1,success:function(e){n.updateprofilepic(s).then(function(e){l.profilePic=s,t.progress=!0,t.myCroppedImage=null,a.reload(),r.success("profile picture updated successfully")},function(e){r.error("profile picture update failed")})}.bind(this),error:function(e,t,a){r.error("profile picture update failed")}.bind(this)})})})},$("#fileInput").change(function(){t.newup=!0}),t.uploadnewprofile=function(){t.newup=!0},l.loading=!0,t.viewstockarea=function(a){t.view=!0,t.newsa=!1,t.stockareaId=a,t.readname=!0,t.htmlTextToolTip=e.trustAsHtml('<div class="packageNameTooltip">You cannot change stockarea name.</div>');new google.maps.StyledMapType(p,{name:"Styled Map"}),new google.maps.Geocoder({region:"IN"});s.stockareaInfo(a).then(function(e){l.loading=!1,t.stockareaemails=e.data.data[0].emails,t.stockareamobiles=e.data.data[0].mobiles,t.stockareamobile=e.data.data[0].phone,t.stockareamobilep=e.data.data[0].phone,t.stockareaemail=e.data.data[0].primaryemail,t.stockareaemailp=e.data.data[0].primaryemail,t.stockareaId=e.data.data[0]._id,t.stockareaName=e.data.data[0].stockareaName,t.latitude=e.data.data[0].latitude,t.la=e.data.data[0].latitude,t.longitude=e.data.data[0].longitude,t.lon=e.data.data[0].longitude,t.address1=e.data.data[0].address,t.add1=e.data.data[0].address,t.phone=parseInt(e.data.data[0].phone),t.ph=parseInt(e.data.data[0].phone),t.lati=parseFloat(t.latitude),t.lngi=parseFloat(t.longitude);var a=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(t.lati,t.lngi),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});google.maps.event.trigger(a,"resize");var o={lat:t.lati,lng:t.lngi},n=new google.maps.Marker({position:o,draggable:!1,optimized:!1,map:a});[].push(n)})},t.editStockarea=function(a){t.view=!1,t.newsa=!1,t.stockareaId=a,t.readname=!0,t.htmlTextToolTip=e.trustAsHtml('<div class="packageNameTooltip">You cannot change stockarea name.</div>');new google.maps.StyledMapType(p,{name:"Styled Map"}),new google.maps.Geocoder({region:"IN"});s.stockareaInfo(a).then(function(e){l.loading=!1,t.stockareaemails=e.data.data[0].emails,t.stockareamobiles=e.data.data[0].mobiles,t.stockareamobile=e.data.data[0].phone,t.stockareamobilep=e.data.data[0].phone,t.stockareaemail=e.data.data[0].primaryemail,t.stockareaemailp=e.data.data[0].primaryemail,t.stockareaId=e.data.data[0]._id,t.stockareaName=e.data.data[0].stockareaName,t.latitude=e.data.data[0].latitude,t.la=e.data.data[0].latitude,t.longitude=e.data.data[0].longitude,t.lon=e.data.data[0].longitude,t.address1=e.data.data[0].address,t.add1=e.data.data[0].address,t.phone=parseInt(e.data.data[0].phone),t.ph=parseInt(e.data.data[0].phone),t.lati=parseFloat(t.latitude),t.lngi=parseFloat(t.longitude);var a=[],o=new google.maps.Map(document.getElementById("map2"),{zoom:3,fullscreenControl:!1,center:new google.maps.LatLng(t.lati,t.lngi),mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain","styled_map"]}});google.maps.event.trigger(o,"resize");var n={lat:t.lati,lng:t.lngi},r=new google.maps.Marker({position:n,draggable:!0,optimized:!1,map:o});a.push(r),google.maps.event.addListener(r,"dragend",function(e){displayPosition(t,this.getPosition())}),google.maps.event.addListener(r,"click",function(e){displayPosition(t,this.getPosition())});var i=document.getElementById("searchmap"),c=new google.maps.places.SearchBox(i);google.maps.event.addListener(c,"places_changed",function(){var e=c.getPlaces();if(0!=e.length){for(var n,r=0;n=a[r];r++)n.setMap(null);a=[];var i,s=new google.maps.LatLngBounds;for(r=0;i=e[r];r++){i.icon,new google.maps.Size(71,71),new google.maps.Point(0,0),new google.maps.Point(17,34),new google.maps.Size(25,25);o.setOptions({minZoom:1,maxZoom:16}),n=new google.maps.Marker({draggable:!0,map:o,title:i.name,optimized:!1,position:i.geometry.location}),displayPosition(t,i.geometry.location),google.maps.event.addListener(n,"dragend",function(e){displayPosition(t,this.getPosition())}),google.maps.event.addListener(n,"click",function(e){displayPosition(t,this.getPosition())}),a.push(n),s.extend(i.geometry.location)}o.fitBounds(s)}}),google.maps.event.addListener(o,"bounds_changed",function(){var e=o.getBounds();c.setBounds(e)})})},t.newstockarea=function(){t.view=!1,t.newsa=!0,t.readname=!1,t.stockareaId=null,t.stockareaName=null,t.latitude=null,t.longitude=null,t.phone=null,t.stockareamobile=null,t.stockareamobiles=null,t.stockareaemails=null,t.stockareaemail=null,t.address1=null,t.htmlTextToolTip=null},t.addprimary=function(){t.pe==t.emailp||n.addprimary(t.emailp).then(function(e){200==e.data.code?(t.pe=t.emailp,t.init(),r.success(t.emailp+"is made as your primary email")):413==e.data.code?r.error(t.emailp+" is not verified"):r.error(t.emailp+"as primary update Failed")},function(e){r.error(t.emailp+"as primary update Failed")})},t.getstockareainfo=function(e){s.stockareaInfo(e).then(function(e){t.stockareaemails=e.data.data[0].emails,t.stockareamobiles=e.data.data[0].mobiles,t.stockareamobile=e.data.data[0].phone,t.stockareaemail=e.data.data[0].primaryemail,t.stockareaId=e.data.data[0]._id,t.stockareaName=e.data.data[0].stockareaName,t.stockareaemailp=t.stockareaemail,t.stockareamobilep=t.stockareamobile,t.latitude=e.data.data[0].latitude,t.longitude=e.data.data[0].longitude,t.address1=e.data.data[0].address,t.phone=parseInt(e.data.data[0].phone),t.lati=parseFloat(t.latitude),t.lngi=parseFloat(t.longitude)})},t.addprimarymobile=function(){null===t.mobilep&&t.mobilep===t.mobile||n.addprimarymobile(t.mobilep).then(function(e){200==e.data.code?(t.init(),r.success(t.mobilep+"is made as your primary mobilenumber")):413==e.data.code?r.error(t.mobilep+" is not verified"):r.error(t.mobilep+"as primary update Failed")},function(e){r.error(" mobile number update Failed")})},t.addprimarystockarea=function(){null!=t.stockareaemailp&&t.stockareaemailp?n.addprimarystockarea(t.stockareaemailp,t.stockareaId).then(function(e){200==e.data.code?(t.getstockareainfo(t.stockareaId),r.success(t.stockareaemailp+"is made as your primary email")):413==e.data.code?r.error(t.stockareaemailp+" is not verified"):r.error(t.stockareaemailp+"as primary update Failed")},function(e){r.error(t.stockareaemailp+"as primary update Failed")}):r.error("please select a valid email")},t.addprimarymobilestockarea=function(){null!=t.stockareamobilep&&t.stockareamobilep?n.addprimarymobilestockarea(t.stockareamobilep,t.stockareaId).then(function(e){200==e.data.code?(t.getstockareainfo(t.stockareaId),r.success(t.stockareamobilep+"is made as your primary mobilenumber")):413==e.data.code?r.error(t.stockareamobilep+" is not verified"):r.error(t.stockareamobilep+"as primary update Failed")},function(e){r.error(" mobile number update Failed")}):r.error("please select a valid email")},t.id1=!1,t.deleteemail=function(e){n.deleteemail(e).then(function(a){t.init(),r.success(e+" deleted successfully")},function(t){r.error(e+"delete Failed")})},t.deletemobile=function(e){n.deletemobile(e).then(function(a){t.init(),r.success(e+"deleted successfully")},function(t){r.error(e+"delete Failed")})},t.deleteemailstockarea=function(e){n.deleteemailstockarea(e,t.stockareaId).then(function(a){t.getstockareainfo(t.stockareaId),r.success(e+" deleted successfully")},function(t){r.error(e+"delete Failed")})},t.deletemobilestockarea=function(e){n.deletemobilestockarea(e,t.stockareaId).then(function(a){t.getstockareainfo(t.stockareaId),r.success(e+"deleted successfully")},function(t){r.error(e+"delete Failed")})},t.addsecondary=function(){t.se==t.semail||n.addsecondary(t.semail).then(function(e){t.se=t.semail,t.init(),r.success("seconday mail updated successfully")},function(e){r.error("Update Failed")})},t.addnewmail=function(){t.pe==t.emailnew&&null==t.pe||!t.validateEmail(t.emailnew)?r.error(" enter valid email Id "):n.addnewmail(t.emailnew).then(function(e){"200"!=e.data.code?r.error("Email id already associated with another account"):(t.em=t.emailnew,r.success("Email added successfully"),t.emailnew=null,t.init())},function(e){r.error("Error adding emailId")})},t.addnewmailstockarea=function(){t.stockareaemailnew&&null!=t.stockareaemailnew&&t.validateEmail(t.stockareaemailnew)?n.addnewmailstockarea(t.stockareaemailnew,t.stockareaId).then(function(e){t.getstockareainfo(t.stockareaId),"200"!=e.data.code?r.error("email id already associated with another account"):(r.success("Email added successfully"),t.stockareaemailnew=null)},function(e){r.error("Error adding emailId")}):r.error("Enter valid emailId")},t.addnewmobilestockarea=function(){null==t.stockareamobilenew||"+91"==t.stockareamobilenew||n.addnewmobilestockarea(t.stockareamobilenew,t.code,t.stockareaId).then(function(e){"200"!=e.data.code?r.error("Mobile number already associated with another account"):(r.success("Mobilenumber added successfully"),t.stockareamobilenew=null,t.getstockareainfo(t.stockareaId))},function(e){r.error("Error adding Mobilenumber")})},t.addnewmobile=function(){null==t.mobilenew||"+91"==t.mobilenew||n.addnewmobile(t.mobilenew,t.code).then(function(e){"200"!=e.data.code?r.error("Mobile NUmber already associated with another account"):(r.success("Mobilenumber added successfully"),t.mobilenew=null,t.init())},function(e){r.error("Error adding Mobilenumber")})},t.updateorganisation=function(){null==t.id?null==t.orgname||null==t.orgas||null==t.orgfrom||null==t.orgto?r.error("Please check the inputs"):n.updateorganisation(t.orgname,t.orgas,t.orgfrom,t.orgto).then(function(e){t.orgfrom=" ",t.orgas=" ",t.orgname=" ",t.orgto="till-now",t.id=null,t.id1=!1,t.init(),r.success("Organisation details added successfully.")},function(e){r.error("Error adding organisation details")}):n.editorganisation(t.id,t.orgname,t.orgas,t.orgfrom,t.orgto).then(function(e){t.id1=!1,t.init(),r.success("Organisation details edited successfully.")},function(e){r.error("Error updating organisation details")})},t.selectorg=function(e){t.id=e;for(var a=0;a<t.organisation.length;a++)t.organisation[a]._id==e&&(t.id1=!0,t.orgname=t.organisation[a].name,t.orgas=t.organisation[a].as,t.orgfrom=t.organisation[a].from,t.orgto=t.organisation[a].to)},t.resetorg=function(){t.orgfrom="",t.orgas="",t.orgname="",t.orgto="till-now",t.id1=!1},t.showmap=!0,t.addnew=function(){t.id1=!0,t.orgfrom="",t.orgas="",t.orgname="",t.orgto="till-now"},t.getDateFormat=function(e,t){var a=new Date(e),o=new Date(t);return a.getDate()==o.getDate()?"HH:mm":"MM.yyyy"},t.editorganisation=function(e){n.editorganisation(e,t.orgname,t.orgas,t.orgfrom,t.orgto).then(function(e){t.init(),r.success("Organisation details edited successfully")},function(e){r.error("Error updating organisation details")})},t.verify=function(e){n.verify(e).then(function(e){r.success("Mail sent successfully"),t.init()},function(e){r.error("Mail Not sent !Error")})},t.otp=!1,t.verifymobile=function(e){t.hours=0,t.minutes=60,n.verifymobile(e).then(function(e){200==e.data.code?(t.otp=!0,r.success("Otp sent successfully"),t.countdown()):r.error("Otp Not sent !Error")},function(e){r.error("Otp Not sent !Error")})},t.otp1=!1,t.verifymobile1=function(e){t.hours1=0,t.minutes1=60,n.verifymobile(e).then(function(e){r.success("Otp sent successfully");u.open({templateUrl:"views/dashboard/otp.html",controller:"otpctrl",size:"sm",resolve:{minute:function(){return 60},hour:function(){return 0},stockareaId:function(){return t.stockareaId}}}).result.then(function(e){},function(e){"cancel"==e||(t.init(),t.viewstockarea(t.stockareaId))})})},t.account=1,t.deleteuser=function(){n.deleteuser(t.password).then(function(e){"200"==e.data.code?(r.success("User deleted Successfully"),t.ud=!1,localStorage.clear(),a.go("login")):r.error("you entered wrong password")},function(e){r.error(e)})},t.countdown=function e(){0==t.minutes&&0==t.hours||(0==t.minutes?(t.minutes=60,t.hours--):t.minutes--,d(e,1e3,t.false()))},t.false=function(){0==t.minutes&&(t.otp=!1)},t.deleteemail=function(e){n.deleteemail(e).then(function(a){t.init(),r.success(e+"deleted successfully")},function(t){r.error(e+"Delete failed")})},t.deleteorganisation=function(e){n.deleteorganisation(e).then(function(e){t.init(),r.success("Organisation details deleted successfully")},function(e){r.error("Organisation delete failed")})},t.checkname=function(){null==t.stockareaName||void 0==t.stockareaName.length?(t.na="stockarea name is required",t.state=null):t.stockareaName.length>2?(t.na=null,s.checkname(t.stockareaName).then(function(e){t.exist=e.data.data.exist,0==t.exist?t.state="exist":t.state="Not exist!"})):(t.na=null,t.state=null)},t.latc=function(){null==t.latitude?t.lat="This feild is required":t.lat=null},t.lonc=function(){null==t.longitude?t.lon="This feild is required":t.lon=null},t.addc=function(){null==t.address1&&(t.add="This feild is required")},t.namec=function(){null==t.stockareaName&&(t.na="stockarea name is required")},t.phc=function(){null==t.phone&&(t.ph1="Phone number is required")},t.phonechange=function(){null==t.phone?(t.ph="Phone number is required",t.phonestate=null):(t.ph=null,s.phonechange(t.phone).then(function(e){t.exist=e.data.data.exist,0==t.exist?t.phonestate="exist":t.phonestate="Not exist!"}))},t.fnAddStockarea=function(e){if(null!==t.stockareaName&&null!==t.latitude&&null!==t.longitude&&null!==t.phone&&void 0!==t.stockareaName&&void 0!==t.latitude&&void 0!==t.longitude&&void 0!==t.phone)if(null==t.stockareaId||void 0==t.stockareaId){var o={stockareaName:t.stockareaName,latitude:t.latitude,longitude:t.longitude,phone:t.phone,code:t.code,address:t.address1,organisationId:l.orgId};0==t.exist&&s.postAddStockarea(o).then(function(e){r.success("Stockarea added successfully"),a.go("home.virtualgodown")},function(e){r.error("Stockarea Not Added")})}else{o={Id:t.stockareaId,latitude:t.latitude,longitude:t.longitude,phone:t.phone,code:t.code,address:t.address1};t.la===t.latitude&&t.lon===t.longitude&&t.ph===t.phone&&t.add1===t.address1||s.updatestockarea(o).then(function(e){t.view=!0,r.success("Stockarea Updated successfully")},function(e){r.error("Stockarea Not Added")})}else null!=t.stockareaName&&void 0!=t.stockareaName||(t.na="stockarea name required"),null==t.phone&&(t.phonestate=null,t.ph="Phone number is required")}}]),vgApp.controller("profileController",["$scope","$state","$log","loginService","Notification","localStorageService","$rootScope",function(e,t,a,o,n,r,i){i.indexloader="false",e.options={maximize:!1,data:{x:261,y:7,width:56,height:56}},e.init=function(){i.loading=!0,e.newup=!1,o.getUserDetails().then(function(t){i.loading=!1,e.fullname=t.data.data.fullName,null!=t.data.data.dob&&t.data.data.dob&&void 0!=t.data.data.dob&&(e.dob=t.data.data.dob.slice(0,10)),e.mobile=t.data.data.phone,e.email=t.data.data.userName,e.company=t.data.data.company,e.address=t.data.data.address,e.url=t.data.data.profilePic}),o.gethistoryview().then(function(t){e.history=t.data.data})},e.myFile=null,e.myCroppedImage="",e.myImage="",e.uploadFile=function(t){if(t){var a=new FileReader;a.onload=function(t){e.$apply(function(e){e.myImage=t.target.result})},a.readAsDataURL(t)}},e.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},e.settings=function(){t.go("settings")},e.progress=!0,e.uploadimg=function(){o.geturl(e.img).then(function(a){e.urltoFile(e.myCroppedImage,a.data.name+".jpg","image/jpeg").then(function(r){var c=r,s=a.data.signed_request,l=a.data.url;(new Image).src=e.myCroppedImage,e.progress=!1,$.ajax({type:"PUT",data:c,url:s,processData:!1,contentType:!1,success:function(a){o.updateprofilepic(l).then(function(a){i.profilePic=l,e.progress=!0,n.success("profile picture updated successfully"),e.myCroppedImage=null,t.reload()},function(e){n.error("profile picture update failed")})}.bind(this),error:function(e,t,a){n.error("profile picture update failed")}.bind(this)})})})},$("#fileInput").change(function(){e.newup=!0}),e.uploadnewprofile=function(){e.newup=!0}}]),vgApp.controller("signupController",["$scope","$uibModal","$rootScope","$state","$log","loginService","Notification","localStorageService",function(e,t,a,o,n,r,i,c){e.login=function(){o.go("login")},a.indexloader="false";var s=localStorage.getItem("access_token");localStorage.getItem("userId");null==s&&void 0==s||r.isAuthenticated().then(function(e){o.go("home.virtualgodown")},function(e){}),e.validatepassword=function(e){return/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/.test(e)},e.passwordchange=function(){null==e.userPassword?e.passworderror="empty":e.validatepassword(e.userPassword)?e.passworderror=!1:e.passworderror=!0},e.emailchange=function(){null==e.email||void 0==e.email.length?e.emailstate="empty":e.email.length>6&&e.validateEmail(e.email)?r.emailchange(e.email).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.emailstate="exist":e.emailstate="Not exist!"}):(e.email.length<6||6==e.email.length||!e.validateEmail(e.email))&&(e.emailstate="Not exist!")},e.namechange=function(){null==e.fullName?e.namestate="empty":e.namestate=""},e.useridchange=function(){null==e.userid||void 0==e.userid.length?e.useridstate="empty":e.userid.length>6?r.useridchange(e.userid).then(function(t){e.exist=t.data.data.exist,0==e.exist?e.useridstate="exist":e.useridstate="Not exist!"}):e.useridstate="Not exist!"},e.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.viewTerms=function(e,a){t.open({templateUrl:domainURL+"views/dashboard/terms.html",controller:"termsController",size:"lg"}).result.then(function(){},function(){})},e.fnRegisterUser=function(){e.data={userid:e.userid,fullName:e.fullName,userName:e.email,password:e.userPassword},e.passwordchange(),e.emailchange(),e.namechange(),e.useridchange(),"exist"==e.emailstate&&"exist"==e.useridstate&&e.validateEmail(e.email)&&e.validatepassword(e.userPassword)&&r.registerUser(e.data).then(function(t){"200"==t.data.code?r.authenticateUser(e.email.toLowerCase(),e.userPassword).then(function(t){t.data.token?(localStorage.clear(),localStorage.setItem("access_token",t.data.token),localStorage.setItem("userId",t.data.userId),r.getUserDetails().then(function(e){"200"!=e.data.code?i.error(e.data.message):(a.fullName=e.data.data.fullName,a.profilePic=e.data.data.profilePic,a.userId=e.data.data._id,a.org=e.data.data.org,localStorage.setItem("orgId",e.data.data.org[0].organisationId._id),a.orgId=e.data.data.org[0].organisationId._id,a.orgname=a.org[0].organisationId.organisationId,a.orgstatus=a.org[0].organisationId.status,n.info("User Authenticated Successfully"),o.go("home.virtualgodown")),"pendingstock"==e.data.data.status&&(a.userstatus="pending")},function(t){e.access=!1,e.loading=!1})):i.error(t.data.message)},function(e){i.error(e.data.message)}):i.error(t.data.message)},function(e){i.error("Error! User Not added")})}}]);function displayPosition(e,t){document.getElementById("latitude").value=t.lat(),document.getElementById("longitude").value=t.lng(),e.latitude=t.lat(),e.longitude=t.lng()}vgApp.controller("forgotPasswordController",["$scope","$sce","loginService","Notification","$state","localStorageService","$rootScope","$stateParams",function(e,t,a,o,n,r,i,c){i.indexloader="false",localStorage.clear(),e.email=c.term,e.changemail=function(){null==e.email?(e.errmg="Email id required",console.log(e.email),console.log("nulllllllllllllllllllllllllllllllllllll")):(console.log(e.email),console.log("nonnulllllllllllllllllllllllllllllllllllll"),e.validateEmail(e.email)?e.errmg=null:e.errmg="Email is invalid")},e.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},e.msg=!1,e.fnSendChangePasswordURL=function(){e.changemail(),e.data={username:e.email},e.validateEmail(e.email)&&a.forgotPassword(e.data).then(function(t){"error"==t.data.status?o.error("Email id is not registered"):(e.Message="We have sent a reset link to your email",e.msg=!0)},function(e){o.error("Email id is not registered")})}}]),vgApp.controller("onVerifyActionController",["$scope","$rootScope","loginService","$stateParams","$state","Notification",function(e,t,a,o,n,r){t.highlightcollabrator=null,t.indexloader="false",a.verifyToken(o.token).then(function(e){"error"==e.data.status?r.error("Invalid Token"):(t.userEmail=e.data.data.username,n.go("resetPassword"))})}]),vgApp.controller("verifyemailcontroller",["$scope","$rootScope","loginService","$stateParams","$state","Notification",function(e,t,a,o,n,r){t.highlightcollabrator=null,t.indexloader="false",alert("i vf"),a.verifyemail(o.token,o.email).then(function(e){"error"==e.data.status?r.error("Invalid Token"):n.go("settings")},function(e){r.error(e)})}]),vgApp.controller("resetPasswordController",["$location","$scope","$rootScope","$state","loginService","Notification","$stateParams","localStorageService",function(e,t,a,o,n,r,i,c){a.highlightcollabrator=null,a.indexloader="false",t.init=function(){localStorage.clear(),n.validatetoken(i.token).then(function(e){1==e.data.data.valid?localStorage.clear():(a.info="token",o.go("login"))})},t.validatepassword=function(e){return/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/.test(e)},t.updatePassword=function(){t.validatepassword(t.confirmPassword)?(t.data={token:i.token,newPassword:t.confirmPassword},n.verifyToken(t.data).then(function(e){200==e.data.code?(r.success("Password has been changed."),a.info="changepassword",o.go("login")):(a.info="token",o.go("login"))},function(e){a.info="token",o.go("login")})):t.passworderror=!0},t.passwordchange=function(){null==t.confirmPassword?t.passworderror=null:t.validatepassword(t.confirmPassword)?t.passworderror=!1:t.passworderror=!0}}]),vgApp.controller("collabratorctrl",["$location","$scope","$rootScope","$state","loginService","Notification","$stateParams","localStorageService",function(e,t,a,o,n,r,i,c){var s=localStorage.getItem("access_token");a.highlightcollabrator=null,a.indexloader="false",null!==i.token||void 0!==i.token||null!==i.value||void 0!==i.value?"accept"==i.value?n.collabrator(i.token).then(function(e){null==s||void 0==s?o.go("login"):e.data.data.orgId?(a.orgId=e.data.data.orgId,window.location.reload()):(localStorage.clear(),o.go("login"))},function(e){localStorage.clear(),o.go("login")}):"decline"==i.value&&n.deletecollabratorrequest(i.token).then(function(e){null==s||void 0==s?o.go("login"):e.data.data.orgId?(a.orgId=e.data.data.orgId,window.location.reload()):(localStorage.clear(),o.go("login"))},function(e){localStorage.clear(),o.go("login")}):(localStorage.clear(),o.go("login"))}]),vgApp.controller("termsController",["$uibModalInstance","$scope",function(e,t){$rootScope.indexloader="false",t.close=function(){e.dismiss("cancel")}}]),vgApp.controller("suggestproductController",["$scope","loginService","$sce","Notification","$rootScope",function(e,t,a,o,n){n.indexloader="false",e.new=!1,e.filter={},e.show={},e.newspec=!1,e.onaddvar=function(t){e.newvar=null,e.newvar1=null,e.newspec=!1,e.new=!0,e.ki=t;$("#newvar1").val(""),$("#newvar").val("")},e.varval=function(t,a){e.filter[t]=a},e.removevar=function(){e.new=!1;$("#newvar").val("")},e.removespec=function(){e.newspec=!1;$("#newvar1").val("")},e.MyFunc=function(t,o){e.htmlTextToolTip=a.trustAsHtml('<div class="packageNameTooltip">Press enter key to add<br> Press esc key to ignore</div>');var n=o;if(null==t||void 0==t||null==n||void 0==n);else{e.new=!1;for(key1 in e.filters)if(t==key1){var r=e.filters[t];e.filter[t]=n,r.push({name:n,status:!1}),n=$("#newvar").val("")}}},e.delvar=function(t,a){var o;for(i=0;i<e.filters[t].length;i++)e.filters[t][i].name==a&&(o=i);e.filters[t].splice(o,1)},e.delspec=function(t){for(key1 in e.filters)t==key1&&delete e.filters[t]},e.newfilter=function(){e.htmlTextToolTip=a.trustAsHtml('<div class="packageNameTooltip">Press Enter key to add<br> Press esc key to ignore</div>'),e.newspec=!0,e.new=!1,e.newvar=null,e.newvar1=null},e.MyFunc1=function(t){null==t||void 0==t||(e.newspec=!1,e.filters[t]=[],e.show[t]=!1,t=$("#newvar1").val(""))},e.reset=function(t){e.filter[t]=null,e.new=!1;$("#newvar").val("")},e.addsuggest=function(){t.addsuggest(e.materialId,e.filter).then(function(e){o.success("suggestion addded successfully")},function(e){o.error("Error adding suggestion")})},e.autocomplete=function(){$("#autocompletesearch").autocomplete({source:function(e,t){$.ajax({dataType:"json",data:{term:e.term},type:"Get",contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:!1},crossDomain:!0,cache:!0,url:domainURL+"api/material/autocomplete",success:function(a){var o=$.map(a.data,function(e){return{label:e.materialName,value:e.materialName}});t($.ui.autocomplete.filter(o,e.term))},error:function(e){}})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.submit(a.item.value)}})},e.submit=function(a){if(null!==a){e.term=a;var o=[];t.material(a).then(function(t){e.search=a,materialId=t.data._id,e.materialId=t.data._id,e.filters=t.data.specifications;for(kys in e.filters)o.push(kys);e.showbox=o[0]},function(e){})}}}]),vgApp.controller("otpctrl",["$scope","loginService","$uibModalInstance","minute","hour","stockareaId","$timeout","$uibModal","Notification","$rootScope",function(e,t,a,o,n,r,i,c,s,l){l.highlightcollabrator=null,e.minutes1=o,l.indexloader="false",e.hours1=n,e.close=function(){a.dismiss("cancel")},e.submitotp1=function(){null==e.motp?s.error("Enter a valid OTP"):6==e.motp.length&&t.submitotp(e.motp).then(function(e){s.success("Mobile Number Verified Successfully"),a.dismiss(r)},function(e){s.error(e)})},e.countdown1=function t(){0==e.minutes1&&0==e.hours1||(0==e.minutes1?(e.minutes1=60,e.hours1--):e.minutes1--,i(t,1e3,e.false1()))},e.false1=function(){0==e.minutes1&&a.dismiss(r)}}]),vgApp.controller("deleteuserctrl",["$scope","loginService","$uibModalInstance","userId","$timeout","$uibModal","Notification","$rootScope",function(e,t,a,o,n,r,i,c){c.highlightcollabrator=null,e.close=function(){a.dismiss("cancel")},e.delete=function(){t.deleteuser(e.password).then(function(e){"200"==e.data.code?(i.success("User deleted Successfully"),a.dismiss("done")):(i.success("you entered wrong password"),a.dismiss("cancel"))},function(e){i.error(e)})},e.countdown1=function t(){0==e.minutes1&&0==e.hours1||(0==e.minutes1?(e.minutes1=60,e.hours1--):e.minutes1--,n(t,1e3,e.false1()))},e.false1=function(){0==e.minutes1&&a.dismiss(stockareaId)}}]),vgApp.controller("materialViewSellCtrl",["$sce","$scope","dashboardService","productid","$uibModalInstance","$state","$timeout","$uibModal","$rootScope","Notification","$log",function(e,t,a,o,n,r,i,c,s,l,d){s.highlightcollabrator=null;var u=localStorage.getItem("selectedStockareaId");t.htmlTextToolTip=e.trustAsHtml('<div style="background-color:white; color:white;"> Hello</div>'),t.onChangePricePerPackage=function(a,o){t.addsellbutton=!0,a.priceperpack=parseInt(o.target.value),t.htmlTextToolTip=e.trustAsHtml('<div class="packageNameTooltip">'+a.name+"</div>Price Per Package: "+a.priceperpack+"<br> Cost Per Kg: "+a.priceperpack/a.size)},t.onChangeQuantityAvaliabity=function(a,o){t.addsellbutton=!0,a.packagesAvailable=parseInt(o.target.value);var n=parseInt(a.packagesAvailable)||0,r=parseInt(a.MinimumOrder)||0;a.AvaliabityError=n<r;var i='<div class="AvailError"> ERROR! <br> Available Quantity is less than Minmiun Quantity so you may not get listed.</div>';a.AvaliabityError||(i=""),t.htmlTextToolTip=e.trustAsHtml('<div class="packageNameTooltip">'+a.name+"</div>Quantity Avaliabity: "+a.packagesAvailable+"<br> Cost: "+a.packagesAvailable*a.priceperpack+"<br> Available Quantity in Kgs: "+a.packagesAvailable*a.size+"<br> Cost Per Kg: "+a.priceperpack/a.size+i)},t.addsellbutton=!1,t.getAvailError=function(e){var t=parseInt(e.packagesAvailable)||0,a=parseInt(e.MinimumOrder)||0;e.AvaliabityError=t<a},t.onlyNumbers=/^\d+$/,t.onChangeMinmiunQuantity=function(a,o){t.addsellbutton=!0,a.MinimumOrder=o.target.value;var n=parseInt(a.packagesAvailable)||0,r=parseInt(a.MinimumOrder)||0;a.AvaliabityError=n<r,t.htmlTextToolTip=e.trustAsHtml("Minmiun Quantity"+a.MinimumOrder),void 0!=a.priceperpack&&""!=a.priceperpack.trim()&&null!=a.priceperpack&&(t.htmlTextToolTip=e.trustAsHtml('<div class="packageNameTooltip">'+a.name+"</div>Minmiun Quantity: "+a.MinimumOrder+"<br> Cost: "+a.MinimumOrder*a.priceperpack+"<br> Quantity in Kgs: "+a.MinimumOrder*a.size+"<br> Cost Per Kg: "+a.priceperpack/a.size))},t.selection=[],t.toggleSelection=function(e){var a=t.selection.indexOf(e);if(a>-1){t.selection.splice(a,1);for(var o=0;o<t.packages.length;o++)t.packages[o].packageId==e&&(t.packages[o].status=!1)}else{t.selection.push(e);for(o=0;o<t.packages.length;o++)t.packages[o].packageId==e&&(t.packages[o].status=!0)}t.addsellbutton=!0},t.setproductunit=function(e,a){console.log(e),$("#unit").removeClass("open");for(var o=0;o<t.packages.length;o++)"custom"==t.packages[o].name&&(t.packages[o].unit=a)},s.sellloading=!0,a.units().then(function(e){t.units=e.data}),a.derivedunits().then(function(e){t.derivedunits=e.data}),a.getProductSellInfo(o,u).then(function(e){if(s.sellloading=!1,null!=e.data.data){t.productSellInfo=e.data.data,t.unit=t.productSellInfo.productId.unit,t.stockareaname=t.productSellInfo.stockareaId.stockareaName,t.packages=t.productSellInfo.productId.package;for(var a=0;a<t.packages.length;a++)t.packages[a].status,1==t.packages[a].status&&(t.packages[a].MinimumOrder=parseInt(t.packages[a].MinimumOrder),t.packages[a].packagesAvailable=parseInt(t.packages[a].packagesAvailable),t.packages[a].priceperpack=parseInt(t.packages[a].priceperpack),t.packages[a].status=JSON.parse(t.packages[a].status),t.selection.push(t.packages[a].packageId));t.currency="INR"}},function(e){l.error("Product Sell Info Not Available"),d.info("Product Sell Info Not Available")}),t.currency=":NR",t.units=[{name:"Kilogram"},{name:"Ton"}],t.sdUnit="kilogram",t.unit="kilogram",t.packages=[],t.custom={},t.submit=function(){var e={stockareaId:u,productId:o,productStockId:t.productSellInfo.productstockId,packages:t.packages,unit:t.unit},r=/^\d+$/;t.error=!1;for(var i=0;i<t.packages.length;i++)1==t.packages[i].status&&(r.test(parseInt(t.packages[i].MinimumOrder))&&r.test(parseInt(t.packages[i].packagesAvailable))&&r.test(parseInt(t.packages[i].priceperpack))||(t.error=!0));0==t.error?a.addSell(e).then(function(e){"200"==e.data.code?(l.success("Stock details updated successfully"),a.getProductStockInfo(o,u,t.productSellInfo.productstockId).then(function(e){null!=e.data.data&&(t.productStockInfo=e.data.data,n.dismiss(t.productStockInfo.stockDetails))},function(e){l.error("Error updating Stock details")})):l.error(e.data.message)},function(e){l.error("Error updating Stock details"),d.info("Sell Not Added")}):l.error("Please check the inputs")},t.close=function(){n.dismiss("cancel")}}]),vgApp.controller("messagecontroller",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state",function(e,t,a,o,n,r,i){e.showmessages=function(){$("#qnimate").addClass("popup-box-on"),$("#messagebox").animate({scrollTop:screen.height+screen.height},1e3),t.updatemessage().then(function(e){})},r.helpmessage=function(){e.tolist=[],e.tolist.push({userId:"065932a0-e748-11e7-9cf7-e1637e8c1ab9",organisationId:"065932a1-e748-11e7-9cf7-e1637e8c1ab9"}),$("#messageautocompletesearch").val("help@VIRTUALGODOWN"),$("#qnimate").addClass("popup-box-on"),$("#messagebox").animate({scrollTop:screen.height+screen.height},1e3),t.updatemessage().then(function(e){})},e.down=function(){a(function(){return $("#messagebox").animate({scrollTop:$("body").height()}),!1},1e4)},e.down(),e.close=function(){$("#qnimate").removeClass("popup-box-on")},r.highlightcollabrator=null,e.parsedate=function(e){var t=e.split("T")[0],a=new Date(t),o=a.getDate(),n=a.getMonth(),r=a.getFullYear();return o+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n]+"-"+r},e.tolist=[],e.userautocomplete=function(){$("#messageautocompletesearch").autocomplete({position:{my:"left bottom",at:"left top"},classes:{"ui-autocomplete":"messageui"},source:function(e,t){n({url:domainURL+"api/secured/users/messagetoautocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){console.log(e.data.data),t($.map(e.data.data,function(e){return{label:e.label,value:e.label,userid:e.userId,orgid:e.organisationId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.tolist.push({userId:a.item.userid,organisationId:a.item.orgid})}})},e.init=function(){e.textmessage=null,e.tolist=null,e.tosearch=null,e.Id=null,e.receiptentorganisation=null,t.getmessages().then(function(e){r.messages=e.data.data,$("#messagebox").animate({scrollTop:$("#body").height()},1e3)},function(e){console.log(e)})},e.addmessage=function(){if(null==e.tolist||0==e.tolist.length||null==e.textmessage){var a;null!=e.tolist&&0!=e.tolist.length&&void 0!=e.tolist||(a="To address required. "),null!=e.textmessage&&void 0!=e.textmessage||(a="Enter the message"),o.error({message:a,positionY:"top",positionX:"right"})}else t.addmessage(e.textmessage,e.tolist).then(function(t){e.down(),e.init(),$("#messagebox").animate({scrollTop:$("#body").height()},1e3)},function(e){o.error("error sending message")})}}]),vgApp.controller("ownController",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state",function(e,t,a,o,n,r,i){e.deletepackage=function(a,n){var r={packageId:n};t.deletepackage(r).then(function(t){o.success("package seleted successfully"),e.getSearchProducts(a,null)},function(e){o.error("error deleting package")})},e.height=function(){e.productsSearch=[],e.search="";var t=e.products;console.log(t);for(var a=0;a<t.length;a++)t[a].productId.state="ADDED",e.productsSearch.push(t[a].productId);var o,n=screen.height;(n=window.innerHeight)>640?(o=n-60-80-70-20,document.getElementById("searchresult").style.height=o+"px"):(o=430,document.getElementById("searchresult").style.height=o+"px")}}]),vgApp.controller("ProductProfileCtrl",["$scope","dashboardService","$stateParams","$rootScope","Notification",function(e,t,a,o,n){e.profileStockareaName=a.stockareaName,e.profileProductName=a.productName,o.highlightcollabrator=null,o.loading=!0,e.init=function(){t.getProductProfile(e.profileStockareaName,e.profileProductName).then(function(t){e.result=t.data.data,o.loading=!1,e.fullName=e.result.selectedproduct.userinfo.fullName,e.collabratorsinfo=e.result.selectedproduct.userinfo.org,e.userName=e.result.selectedproduct.userinfo.userName,e.stockareacreated=e.result.selectedproduct.stockareaInfo.createdOn.slice(0,10),e.stockareaId=e.result.selectedproduct.stockareaInfo._id,e.phone=e.result.selectedproduct.stockareaInfo.phone,e.visiblity=e.result.selectedproduct.stockareaInfo.visiblity,"1003"==e.visiblity?e.visi="public":e.visi="private",e.producttype=e.result.selectedproduct.type,e.productcollabrators=e.result.selectedproduct.productcollabrators,e.code=e.result.selectedproduct.stockareaInfo.code,e.location=e.result.selectedproduct.stockareaInfo.latitude+","+e.result.selectedproduct.stockareaInfo.longitude,e.updatedstock=e.result.selectedproduct.sellinfo.updatedOn.slice(0,10),e.dealingsince=e.result.selectedproduct.sellinfo.createdOn.slice(0,10),e.url=e.result.selectedproduct.productinfo.productId.primaryImage,e.selldata=e.result.selectedproduct.sellinfo.package})},e.updatesource=function(){t.updatesource(localStorage.getItem("selectedStockareaId"),o.productId,e.stockareaId).then(function(e){n.success("source updates successfully")},function(e){n.success("error updating source")})},e.changeimage=function(t){e.url="brand"==t?e.result.selectedproduct.productinfo.productId.brandId.logo:"package"==t?e.result.selectedproduct.productinfo.productId.package[0].img:e.result.selectedproduct.productinfo.productId.primaryImage}}]),vgApp.controller("reportctrl",["$scope","dashboardService","$timeout","Notification","$uibModalInstance","productid","name",function(e,t,a,o,n,r,i){e.close=function(){n.dismiss("cancel")},e.name=i,e.autoc=!0,e.reportproduct=function(){null!==e.msg&&e.msg&&void 0!==e.msg&&t.addreport(r,e.msg).then(function(e){o.success("Product reported successfully"),n.dismiss("done")},function(e){o.error("cannot able to report at this time")})}}]),vgApp.controller("vgController",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state","$stateParams",function(e,t,a,o,n,r,i,c){r.leftab=1,e.myInterval=3e3,e.productsSearch=[],e.currentSliderIndex=0,e.firstRate=0;e.editproduct=function(e){i.go("home.editproduct",{productId:e})},e.deletepackage=function(a,n){var r={packageId:n};t.deletepackage(r).then(function(t){o.success("package seleted successfully"),e.getSearchProducts(a,null)},function(e){o.error("error deleting package")})},e.movetovg=function(e){t.movetovg(e).then(function(e){o.success("product successfully moved to Virtualgodown")},function(e){o.error("error adding product to vg")})},e.editbrand=function(e){i.go("home.editbrand",{brandId:e})},e.subtab11=function(){document.getElementById("searchresult").style.display="none",e.subtab1=1,e.selectedtab11="active",e.selectedtab12="inactive",e.selectedtab13="inactive"},e.subtab12=function(){e.search=null,e.subtab1=2,e.selectedtab11="inactive",e.selectedtab12="active",e.selectedtab13="inactive"},e.addproductlike=function(a){t.addproductlike(a).then(function(t){e.getSearchProducts(null,e.search)},function(e){o.error("brandmaterial error")})},e.removeproductlike=function(a){t.removeproductlike(a).then(function(t){e.getSearchProducts(null,e.search)},function(e){o.error("brandmaterial error")})},e.viewlikes=function(t){for(var a=e.productsSearch,o=!1,n=0;n<a.length;n++)if(a[n]._id==t)for(var r=a[n].likes,i=0;i<r.length;i++)r[i].userId==localStorage.getItem("userId")&&(o=!0);return o},e.getbrandmaterialinfo=function(a,n){t.getbrandmaterialinfo(a,n).then(function(t){e.materialinfo=t.data.data},function(e){o.error("brandmaterial error")})},e.setBtn=function(){$("#imgScrollLeftBnt").hide(),$("#imgScrollRightBnt").hide();var e=$("#imageList").scrollLeft(),t=$("#imageList")[0].scrollWidth;e>0&&$("#imgScrollLeftBnt").show(),t>e+360&&$("#imgScrollRightBnt").show()},e.resize=function(e){e&&e.target&&void 0!=e.target&&(e.target.style.height=e.target.scrollHeight+"px")},e.setImgSrc1=function(t){e.imgSrc1=t},e.onenterkeyautocomplete=function(t){13==t.which&&($("#autocompletesearch").autocomplete("close"),"product"==e.searchtype?e.getSearchProducts(null,t.target.value):e.getSearchBrands(null,t.target.value))},e.addProductsToStockarea=function(a){var n=[];n.push(a),e.productInfo?e.productInfo.state="ADDED":(e.productInfo={},e.productInfo.state="ADDED");for(var r=0;r<e.productsSearch.length;r++)e.productsSearch[r]._id==a&&(e.productsSearch[r].state="ADDED");t.addProductsToStcokarea(localStorage.getItem("selectedStockareaId"),n).then(function(t){o.success("Product added to "+localStorage.getItem("selectedStockareaName")),e.getStockAreaProductFn(localStorage.getItem("selectedStockareaId"))},function(e){o.error("error")})},e.getSearchProducts=function(a,n){if(document.getElementById("searchresult").style.display="block",null==a)var r={term:n};else r={term:n,productId:a};t.getSearchProductsInfo(r).then(function(t){if(null!=t.data.data){var a=t.data.data,o=e.products;if(null!=e.products&&void 0!=e.products&&e.products)for(var n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");else;e.productsSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available")})},e.getSearchBrands=function(a,n){if(document.getElementById("searchresult").style.display="block",null==a)var r={term:n};else r={term:n,brandId:a};t.getSearchBrandsInfo(r).then(function(t){if(null!=t.data.data){var a=t.data.data;e.brandSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available")})},e.autocomplete=function(){"product"==e.searchtype&&$("#autocompletesearch").autocomplete({source:function(e,t){n({url:domainURL+"api/secured/authorize/products/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,category:e.categoryId.name,productId:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.getSearchProducts(a.item.productId,a.item.value)}}),"brand"==e.searchtype&&$("#autocompletesearch").autocomplete({source:function(e,t){n({url:domainURL+"api/brand/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.brandName,value:e.brandName,brandId:e._id}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.getSearchBrands(a.item.brandId,a.item.value)}})},e.height=function(){e.productsSearch=[];var t,a=screen.height;(a=window.innerHeight)>640?(t=a-60-80-70-20,document.getElementById("searchresult").style.height=t+"px"):(t=430,document.getElementById("searchresult").style.height=t+"px"),e.productsSearch=[],localStorage.getItem("access_token")&&c.productid&&e.getSearchProducts(c.productid,null)}}]),vgApp.controller("myorgController",["$scope","dashboardService","$timeout","Notification","$http","$rootScope","$state",function(e,t,a,o,n,r,i){r.leftab=3,e.searchtype="product",e.productInfo={},e.addproductlike=function(a){t.addproductlike(a).then(function(t){e.getSearchProducts(null,e.search)},function(e){o.error("brandmaterial error")})},e.removeproductlike=function(a){t.removeproductlike(a).then(function(t){e.getSearchProducts(null,e.search)},function(e){o.error("brandmaterial error")})},e.viewlikes=function(t){for(var a=e.productsSearch,o=!1,n=0;n<a.length;n++)if(a[n]._id==t)for(var r=a[n].likes,i=0;i<r.length;i++)r[i].userId==localStorage.getItem("userId")&&(o=!0);return o},e.subtab11=function(){document.getElementById("searchresult").style.display="none",e.subtab1=1,e.selectedtab11="active",e.selectedtab12="inactive",e.selectedtab13="inactive"},e.subtab12=function(){e.subtab1=2,e.selectedtab11="inactive",e.selectedtab12="active",e.selectedtab13="inactive"},e.addlike=function(a,n){t.addlike(e.materialinfo._id,n).then(function(t){e.getbrandmaterialinfo(e.materialinfo._id,n)},function(e){o.error("brandmaterial error")})},e.removelike=function(a,n){t.removelike(e.materialinfo._id,n).then(function(t){e.getbrandmaterialinfo(e.materialinfo._id,n)},function(e){o.error("brandmaterial error")})},e.getbrandmaterialinfo=function(a,n){t.getbrandmaterialinfo(a,n).then(function(t){e.materialinfo=t.data.data},function(e){o.error("brandmaterial error")})},e.setBtn=function(){$("#imgScrollLeftBnt").hide(),$("#imgScrollRightBnt").hide();var e=$("#imageList").scrollLeft(),t=$("#imageList")[0].scrollWidth;e>0&&$("#imgScrollLeftBnt").show(),t>e+360&&$("#imgScrollRightBnt").show()},e.resize=function(e){e&&e.target&&void 0!=e.target&&(e.target.style.height=e.target.scrollHeight+"px")},e.setImgSrc1=function(t){e.imgSrc1=t},e.onenterkeymyassetautocomplete=function(t){13==t.which&&($("#productautocompletesearch").autocomplete("close"),e.getSearchProducts(null,t.target.value))},e.addProductsToStockarea=function(a){var n=[];n.push(a),e.productInfo?e.productInfo.state="ADDED":(e.productInfo={},e.productInfo.state="ADDED");for(var r=0;r<e.productsSearch.length;r++)e.productsSearch[r]._id==a&&(e.productsSearch[r].state="ADDED");t.addProductsToStcokarea(localStorage.getItem("selectedStockareaId"),n).then(function(t){o.success("Product added to "+localStorage.getItem("selectedStockareaName")),e.getStockAreaProductFn(localStorage.getItem("selectedStockareaId"))},function(e){o.error("error")})},e.getSearchProducts=function(a,n){if(document.getElementById("searchresult").style.display="block",null==a)var r={term:n,type:"private"};else r={term:n,productId:a,type:"private"};t.getSearchProductsInfo(r).then(function(t){if(null!=t.data.data){for(var a=t.data.data,o=e.products,n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");e.productsSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available")})},e.productautocomplete=function(){$("#productautocompletesearch").autocomplete({source:function(e,t){n({url:domainURL+"api/secured/authorize/products/autocomplete",method:"GET",headers:{"Content-Type":"application/json; charset=utf-8"},params:{type:"private",term:e.term}}).then(function(e){t($.map(e.data.data,function(e){return{label:e.productName,value:e.productName,productId:e.productId}}))})},minLength:1,open:function(){},close:function(){},focus:function(e,t){},select:function(t,a){e.getSearchProducts(a.item.productId,a.item.value)}})},e.height=function(){var a,n=screen.height;(n=window.innerHeight)>640?(a=n-60-80-70-20,document.getElementById("searchresult").style.height=a+"px"):(a=430,document.getElementById("searchresult").style.height=a+"px");t.getSearchProductsInfo({type:"private",term:" "}).then(function(t){if(null!=t.data.data){var a=t.data.data,o=e.products;if(null!=e.products&&void 0!=e.products&&e.products)for(var n=0;n<a.length;n++)for(var r=0;r<o.length;r++)a[n]._id==o[r].productId.productId&&(a[n].state="ADDED");else;e.productsSearch=a}else e.errorsearch="No products"},function(e){o.error("Product Info Not Available")})},e.pictures=[],e.updateproduct=function(){if(0==e.productimages.length);else for(var a=0;a<e.productimages.length;a++)e.productimages[a].img.indexOf("amazonaws")<-1?e.uploadproductimg(e.productimages[a].img,a):e.pictures.push({img:e.productimages[a].img});e.spec=e.productdescription,t.updateproduct(e.productId,e.productname,e.productcategory,e.producttype,e.productdescription,e.pictures,e.spec).then(function(e){o.success("product updated successfully")},function(e){o.error("error updating product")})},e.uploadproductimg=function(a,o){t.geturl(a).then(function(t){e.pictures.push({img:t.data.url});e.productimages.length;e.urltoFile(a,t.data.name+".jpg","image/jpeg").then(function(e){var a=e;$.ajax({type:"PUT",data:a,url:t.data.signed_request,processData:!1,contentType:"image/jpeg",success:function(e){}.bind(this),error:function(e,t,a){}.bind(this)})})})},e.myCroppedImage="",e.myFile="",$("#fileInput").change(function(){e.newup=!0}),e.uploadnewprofile=function(){e.newup=!0},e.uploadFile=function(t){if(t){var a=new FileReader;a.onload=function(t){e.$apply(function(e){e.myImage=t.target.result})},e.newup=!0,a.readAsDataURL(t)}},e.urltoFile=function(e,t,a){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})},e.productimages=[],e.uploadimg=function(){$("#imgScrollLeftBnt").show(),$("#imgScrollRightBnt").show(),e.productimages.push({img:e.myCroppedImage}),e.newup=!1},e.deletepackage=function(a,n){var r={packageId:n};t.deletepackage(r).then(function(t){o.success("package seleted successfully"),e.getSearchProducts(a,null)},function(e){o.error("error deleting package")})},e.addproductdescription=function(){e.productdescription.push({key:"",value:""})},e.editproduct=function(e){i.go("home.editproduct",{productId:e})},e.removeproductdescription=function(){e.productdescription.pop()}}]);